

CREATE FUNCTION dbo.ALDNUM (@VALORE VARCHAR(50) ,@SEGNO bit ,@INTERO integer,@DECIMALI integer)  
RETURNS VARCHAR(255) AS  
	BEGIN 
	/*	@VALORE	 = Numero da convertire
  		@SEGNO	 = 1 con segno 0 senza segno
		@INTERO	 = Numero di DIGIT per la parte intera
		@DECIMALI	 = Numero di DIGIT per la parte decimale  */
	
	DECLARE @L_INTERO VARCHAR(255)
	DECLARE @L_DECIMALI VARCHAR(255)
	DECLARE @L_POSVIRGOLA INTEGER
	DECLARE @L_SEGNO AS CHAR
	DECLARE @L_RISULTATO AS VARCHAR(255)

	SET @VALORE=STR(@VALORE,@INTERO+@DECIMALI,@DECIMALI)
	SET @L_SEGNO=LEFT(LTRIM(@VALORE),1)
	IF @L_SEGNO='-' 

	BEGIN
		SET @VALORE=(RIGHT(@VALORE,LEN(LTRIM(RTRIM(@VALORE)))-1))
		SET @L_SEGNO='-'
	END
	ELSE
	BEGIN
		SET @L_SEGNO='+'	
	END

	SET @L_POSVIRGOLA= CHARINDEX('.',@VALORE)-1
	IF @DECIMALI>0  AND @L_POSVIRGOLA>-1
	BEGIN
		SET @L_INTERO=LEFT(@VALORE,@L_POSVIRGOLA)
		SET @L_DECIMALI=RIGHT(@VALORE,LEN(@VALORE)-@L_POSVIRGOLA-1)
		SET @L_INTERO=RIGHT(REPLICATE('0',@INTERO)+LTRIM(@L_INTERO),@INTERO)
		SET @L_DECIMALI=LEFT(LTRIM(@L_DECIMALI)+REPLICATE('0',@DECIMALI),@DECIMALI)
		IF @SEGNO=1
			BEGIN
				SET @L_RISULTATO=@L_SEGNO+@L_INTERO+','+@L_DECIMALI
			END
		ELSE
			BEGIN
				SET @L_RISULTATO=@L_INTERO+','+@L_DECIMALI
			END
	END
	ELSE
	BEGIN
		SET @L_INTERO=@VALORE
		SET @L_INTERO=RIGHT(REPLICATE('0',@INTERO)+LTRIM(STR(@L_INTERO)),@INTERO)

		IF @SEGNO=1
			BEGIN
				SET @L_RISULTATO=@L_SEGNO+@L_INTERO
			END
		ELSE
			BEGIN
				SET @L_RISULTATO=@L_INTERO
			END
	END
RETURN @L_RISULTATO
END














GO
GRANT EXECUTE
    ON OBJECT::[dbo].[ALDNUM] TO [Metodo98]
    AS [dbo];


GO
GRANT REFERENCES
    ON OBJECT::[dbo].[ALDNUM] TO [Metodo98]
    AS [dbo];

