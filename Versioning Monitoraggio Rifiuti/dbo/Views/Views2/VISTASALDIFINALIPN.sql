CREATE VIEW VISTASALDIFINALIPN AS 
  SELECT RCONT.CONTO,RCONT.ESERCIZIO,TCONT.PROVVISORIO,TCONT.NRGIORNALE,
    SUM((CASE WHEN RCONT.SEGNO=1 then RCONT.IMPORTO else 0 end)) as DARE,
    SUM((CASE WHEN RCONT.SEGNO=1 then RCONT.IMPORTOEURO else 0 end)) as DAREEURO,
    SUM((CASE WHEN RCONT.SEGNO=1 then RCONT.IMPORTOVALUTA else 0 end)) as DAREVALUTA,
    SUM((CASE WHEN RCONT.SEGNO=0 then RCONT.IMPORTO else 0 end)) as AVERE,
    SUM((CASE WHEN RCONT.SEGNO=0 then RCONT.IMPORTOEURO else 0 end)) as AVEREEURO,
    SUM((CASE WHEN RCONT.SEGNO=0 then RCONT.IMPORTOVALUTA else 0 end)) as AVEREVALUTA,
    SUM((CASE WHEN RCONT.SEGNO=1 THEN RCONT.IMPORTO ELSE 0 END))-SUM((CASE WHEN RCONT.SEGNO=0 THEN RCONT.IMPORTO ELSE 0 END)) AS SALDO,
    SUM((CASE WHEN RCONT.SEGNO=1 THEN RCONT.IMPORTOEURO ELSE 0 END))-SUM((CASE WHEN RCONT.SEGNO=0 THEN RCONT.IMPORTOEURO ELSE 0 END)) AS SALDOEURO,
    SUM((CASE WHEN RCONT.SEGNO=1 THEN RCONT.IMPORTOVALUTA ELSE 0 END))-SUM((CASE WHEN RCONT.SEGNO=0 THEN RCONT.IMPORTOVALUTA ELSE 0 END)) AS SALDOVALUTA
    FROM RIGHECONTABILITA as RCONT,TESTECONTABILITA as TCONT, TABCFG TC
    WHERE(RCONT.NRREG=TCONT.PROGRESSIVO) and TCONT.CAUSALE=(select GIC.CAUSCONTCH from TABVINCOLIGIC as GIC where GIC.ESERCIZIO=TCONT.ESERCIZIO)
    AND TC.CODCONTO=RCONT.CONTO AND TC.TIPOMASTRO<>'E'
    GROUP BY RCONT.ESERCIZIO,RCONT.CONTO,TCONT.PROVVISORIO,TCONT.NRGIORNALE

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTASALDIFINALIPN] TO [Metodo98]
    AS [dbo];

