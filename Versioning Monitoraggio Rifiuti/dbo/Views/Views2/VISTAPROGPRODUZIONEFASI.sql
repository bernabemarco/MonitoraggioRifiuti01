
/*
    rif.30/10/2015 - creata
*/
create view [VISTAPROGPRODUZIONEFASI] as
    select
        PP.NOMEPIANIF
        ,PP.PROG_ID
        ,PP.FASE_ID
        ,PP.RIFPROGRESSIVO as RIFTESTACICLO
        ,PP.RIFNUMEROFASE
        ,TP.TIPOCOM + '/' + cast(TP.ESERCIZIO as varchar) + '/' + cast(TP.NUMEROCOM as varchar) + ' ' + RP.CODICEORD + '/' + cast(RP.IDRIGA as varchar) as RIFORDINE
        ,RP.DATAEMISSIONE
        ,cast(RC.ANNOBOLLA as varchar) + '/' + cast(RC.NUMEROBOLLA as varchar) as RIFBOLLA
        ,RC.OPERAZIONE
        ,(select DESCRIZIONE from TABELLAOPERAZIONI OPE where OPE.CODICE=RC.OPERAZIONE) as DSCOPERAZIONE
        ,RC.FORNITOREASSEGNATO
        ,(select DSCCONTO1 from ANAGRAFICACF CF where CF.CODCONTO=RC.FORNITOREASSEGNATO) as RAGSOCFORNITORE
    from PROGPRODUZIONEFASI PP
        inner join TESTACICLOORDINE TC on TC.PROGRESSIVO=PP.RIFPROGRESSIVO
        inner join TESTEORDINIPROD TP on TP.PROGRESSIVO=TC.IDTESTACOMM
        inner join RIGHEORDPROD RP on RP.IDTESTA=TC.IDTESTACOMM and RP.IDRIGA=TC.IDRIGACOMM
        inner join RIGHECICLOORDINE RC on RC.PROGRESSIVO=PP.RIFPROGRESSIVO and RC.NUMEROFASE=PP.RIFNUMEROFASE

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAPROGPRODUZIONEFASI] TO [Metodo98]
    AS [dbo];

