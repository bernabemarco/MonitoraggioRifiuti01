
-- FINE A#11264

-- INIZIO A#9885
CREATE view [dbo].[VISTATRASFERIMENTOMATERIALIFASE]
  as select
    RIGHEORDPROD.IDTESTA,
    RIGHEORDPROD.IDRIGA,
        (TESTEORDINIPROD.TIPOCOM+'/'+CAST(TESTEORDINIPROD.ESERCIZIO AS VARCHAR(4))+'/'+RIGHT('0000000000'+CAST(TESTEORDINIPROD.NUMEROCOM AS VARCHAR(10)),10)+'/'+RIGHT('00000'+CAST(RIGHEORDPROD.IDRIGA AS VARCHAR(5)),5)) AS RIFORDINE,
        TESTEORDINIPROD.ESERCIZIO,
        TESTEORDINIPROD.TIPOCOM,
        TESTEORDINIPROD.NUMEROCOM,
        TESTEORDINIPROD.DATAEMISSIONE,
        RIGHEORDPROD.CODICEORD,
        RIGHEORDPROD.CODCLIDEST,
        RIGHEORDPROD.CODART AS CODARTORD,
        RIGHEORDPROD.DESCRIZIONEART AS DESCRIZIONEARTORD,
        RIGHEORDPROD.VALOREPRIORITA,
        RIGHEORDPROD.UMGEST,
        RIGHEORDPROD.RIFCOMMCLI,
        RIGHEORDPROD.CODFORDEST,
        TESTACICLOORDINE.PROGRESSIVO,
        RIGHECICLOORDINE.NUMEROFASE,
        RIGHECICLOORDINE.ANNOBOLLA,
        RIGHECICLOORDINE.NUMEROBOLLA,
        (cast(RIGHECICLOORDINE.ANNOBOLLA as varchar(4))+'/'+right('00000000'+cast(RIGHECICLOORDINE.NUMEROBOLLA as varchar(8)),8)) as RIFBOLLA,
        RIGHECICLOORDINE.FORNITOREASSEGNATO AS CODFORFASE,
        (select DSCCONTO1 from ANAGRAFICACF where ANAGRAFICACF.CODCONTO=RIGHECICLOORDINE.FORNITOREASSEGNATO) as DSCFORFASE,
        RIGHECICLOORDINE.OPERAZIONE,
        RIGHECICLOORDINE.CDLAVORO,
        RIGHECICLOORDINE.MACCHINA,
        RIGHECICLOORDINE.TIPOFASE
      from
        TESTACICLOORDINE,RIGHECICLOORDINE,TESTEORDINIPROD,RIGHEORDPROD
      where
        (TESTACICLOORDINE.PROGRESSIVO=RIGHECICLOORDINE.PROGRESSIVO)
        AND (TESTACICLOORDINE.IDTESTACOMM=TESTEORDINIPROD.PROGRESSIVO)
        AND (TESTACICLOORDINE.IDTESTACOMM=RIGHEORDPROD.IDTESTA AND TESTACICLOORDINE.IDRIGACOMM=RIGHEORDPROD.IDRIGA)
        AND (RIGHECICLOORDINE.NUMEROFASE <> 
            (select top 1 NUMEROFASE 
            from RIGHECICLOORDINE RCO 
            where RCO.PROGRESSIVO=RIGHECICLOORDINE.PROGRESSIVO
            order by POSIZIONE))


GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTATRASFERIMENTOMATERIALIFASE] TO [Metodo98]
    AS [dbo];

