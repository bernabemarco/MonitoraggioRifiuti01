

CREATE VIEW [dbo].[VISTA_MB_DettaglioCostiTrasporto_IngressoMerci]
AS

SELECT
     ACQ.PROGRESSIVO
    ,ACQ.ESERCIZIO
    ,ACQ.NRREGISTRAZIONE
    ,ACQLOTTO.TIPODOC
    ,ACQLOTTO.NUMERODOC
    ,ACQLOTTO.CODART
    ,ACQLOTTO.CODDEPOSITO
    ,ACQLOTTO.NRRIFPARTITA
    ,p.UMTOTALEQTA UmQta
    ,TOTALEPEZZI  QTA
    ,(TOTALEPEZZI *COSTOPEZZOXKG)  TOTALE_VALORE_UMQTA
    ,AUmP.UM As UmQtaMC
    ,ACQLOTTO.TOTALEPEZZI * AFC.FATTORE QTAMC
FROM  
    TP_TRASPORTOTOTALEARTICOLOLOTTO ACQLOTTO
INNER JOIN 
    TP_TRASPORTOACQ ACQ
ON 
    ACQ.PROGRESSIVO = ACQLOTTO.RIFPROGRESSIVO
CROSS JOIN  
    MB_PARAMETRI M
CROSS JOIN 
    TP_TRASPORTOPARAMETRIACQ P
Inner Join
       ARTICOLIUMPREFERITE AUmP
On
       AUmP.CODART = ACQLOTTO.CODART And
       AUmP.TIPOUM = M.TIPOUM1
left Join
       ARTICOLIFATTORICONVERSIONE AFC
On
       AFC.CODART = ACQLOTTO.CODART And
       AFC.UM1 = p.UMTOTALEQTA And
       AFC.UM2 = AUmP.UM
Where
       AFC.FATTORE > 0

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTA_MB_DettaglioCostiTrasporto_IngressoMerci] TO [Metodo98]
    AS [dbo];

