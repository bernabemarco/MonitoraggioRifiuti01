
create view Gem_VistaContratti_ControlloAttivitaDaRapporto
as
SELECT     GEM_SEZIONICONTRATTO.IDCONTRATTO, GEM_SEZIONICONTRATTO.SEZIONECONTRATTO, ISNULL(COUNT(GEM_SEZIONECONTRATTORAPPORTI.IDRAPPORTO), 0) 
                      AS ContegRapportiStatoED
FROM         GEM_SEZIONICONTRATTO LEFT OUTER JOIN
                      GEM_SEZIONECONTRATTORAPPORTI ON GEM_SEZIONICONTRATTO.IDCONTRATTO = GEM_SEZIONECONTRATTORAPPORTI.IDCONTRATTO AND 
                      GEM_SEZIONICONTRATTO.SEZIONECONTRATTO = GEM_SEZIONECONTRATTORAPPORTI.SEZIONECONTRATTO
WHERE     (GEM_SEZIONECONTRATTORAPPORTI.STATO = 'E') OR
                      (GEM_SEZIONECONTRATTORAPPORTI.STATO = 'D')
GROUP BY GEM_SEZIONICONTRATTO.IDCONTRATTO, GEM_SEZIONICONTRATTO.SEZIONECONTRATTO

GO
GRANT SELECT
    ON OBJECT::[dbo].[Gem_VistaContratti_ControlloAttivitaDaRapporto] TO [Metodo98]
    AS [dbo];

