CREATE VIEW dbo.BRIOVISTA_TMP_PROMOZIONI_DO AS
SELECT
TP.NUMEROPROMOZIONE, TP.NUMEROCAMPAGNA,TP.TIPO, TP.DESCPROMO,TP.DESCCAMPAGNA, 
(CASE WHEN(TP.TIPO=0) THEN TP.CODICE_DETT ELSE (TP.CODICE_COND)END) AS CODART,
(CASE WHEN(TP.TIPO=0) THEN TP.UM_M_DETT ELSE (CASE WHEN(TP.TIPO=1 AND TP.UM_M='')THEN UM_M_COND ELSE UM_M END)END) AS UM,
(CASE WHEN(TP.TIPO=0) THEN TP.QTABUDGET_DETT ELSE (CASE WHEN(TP.TIPO=1 AND TP.UM_M='')THEN QTABUDGET_COND ELSE TP.QTABUDGET END)END) AS BDG_QTA,
(CASE WHEN(TP.TIPO=0) THEN TP.VALOREBUDGET_DETT ELSE (CASE WHEN(TP.TIPO=1 AND TP.UM_M='')THEN VALOREBUDGET_COND ELSE TP.VALOREBUDGET END)END) AS BDG_VALORE
FROM TP_VISTAPROMOZIONI TP

GO
GRANT SELECT
    ON OBJECT::[dbo].[BRIOVISTA_TMP_PROMOZIONI_DO] TO [Metodo98]
    AS [dbo];

