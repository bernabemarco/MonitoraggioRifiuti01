

CREATE VIEW TP_VISTADOCUMENTIBASE
AS
	SELECT RD.IDTESTA, 
	    RD.ESERCIZIO,
	    RD.TIPODOC, 
	    RD.NUMERODOC, 
	    TD.DATADOC,
	    TD.CODCLIFOR,
	    RD.IDRIGA AS PROGRIGADOC,
	    RD.TIPORIGA,
	    RD.CODART,
	    RD.UMGEST,
	    RD.UMPREZZO,
	    RD.SCONTORIGA,
	    RD.SCONTIESTESI,
	    RD.PREZZOUNITNETTO,
	    RD.PREZZOUNITNETTOEURO,
	    RD.PREZZOUNITLORDO,
	    RD.PREZZOUNITLORDOEURO,
	    '' AS DESCRIZIONEPROMOZIONE,
	    RD.QTAGEST * TD.SEGNO AS QTAGEST
	FROM
	    (
		(RIGHEDOCUMENTI RD INNER JOIN TESTEDOCUMENTI TD ON TD.PROGRESSIVO = RD.IDTESTA)
		INNER JOIN TP_ASSOCIAZIONI_DOC 
			ON RD.TIPODOC = TP_ASSOCIAZIONI_DOC.Cod_Doc AND TP_ASSOCIAZIONI_DOC.Tipo IN(1, 2, 8, 10, 11, 12, 15, 16, 17, 18) 
		
	    )
	WHERE
		RD.UMGEST<>'' AND RD.TIPORIGA='N' AND RD.CODART<>'' AND 
		RD.SCONTORIGA<>100 AND TD.DATADOC > = (CASE 
                                                    WHEN (SELECT TOP 1 ULTPREPAR FROM TP_TRASFAGENTI ORDER BY ULTPREPAR) IS NULL
                                                    THEN '19900101' ELSE (SELECT TOP 1 ULTPREPAR FROM TP_TRASFAGENTI ORDER BY ULTPREPAR)
							END)
							
GO
GRANT DELETE
    ON OBJECT::[dbo].[TP_VISTADOCUMENTIBASE] TO [Metodo98]
    AS [dbo];


GO
GRANT INSERT
    ON OBJECT::[dbo].[TP_VISTADOCUMENTIBASE] TO [Metodo98]
    AS [dbo];


GO
GRANT SELECT
    ON OBJECT::[dbo].[TP_VISTADOCUMENTIBASE] TO [Metodo98]
    AS [dbo];


GO
GRANT UPDATE
    ON OBJECT::[dbo].[TP_VISTADOCUMENTIBASE] TO [Metodo98]
    AS [dbo];

