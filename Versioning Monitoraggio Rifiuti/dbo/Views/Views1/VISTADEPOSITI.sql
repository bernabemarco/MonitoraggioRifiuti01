CREATE VIEW VISTADEPOSITI AS
SELECT ANAGRAFICADEPOSITI.CODICE, 
    ANAGRAFICADEPOSITI.TIPODEPOSITO, 
    ANAGRAFICADEPOSITI.DISPONIBILE, 
    ANAGRAFICADEPOSITI.DESCRIZIONE, 
    ANAGRAFICADEPOSITI.INDIRIZZO, 
    ANAGRAFICADEPOSITI.CAP, 
    ANAGRAFICADEPOSITI.LOCALITA, 
    ANAGRAFICADEPOSITI.PROVINCIA, 
    ANAGRAFICADEPOSITI.TELEFONO, 
    ANAGRAFICADEPOSITI.FAX, 
    ANAGRAFICADEPOSITI.CODNAZIONE, 
    ANAGRAFICADEPOSITI.PRINCIPALE, 
    ANAGRAFICADEPOSITI.NOTE, 
    ANAGRAFICADEPOSITI.DATAINIVALIDITA, 
    ANAGRAFICADEPOSITI.DATAFINEVALIDITA, 
    ANAGRAFICADEPOSITI.UTENTEMODIFICA, 
    ANAGRAFICADEPOSITI.DATAMODIFICA
FROM ANAGRAFICADEPOSITI, TABESERCIZI
WHERE ANAGRAFICADEPOSITI.DATAFINEVALIDITA >= TABESERCIZI.DATAINIMAG
     AND ANAGRAFICADEPOSITI.DATAINIVALIDITA <= TABESERCIZI.DATAFINEMAG
     AND (TABESERCIZI.CODICE = (SELECT ESERCIZIOATTIVO FROM TABUTENTI WHERE USERDB = CAST(USER_NAME() AS VARCHAR(25))))

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTADEPOSITI] TO [Metodo98]
    AS [dbo];

