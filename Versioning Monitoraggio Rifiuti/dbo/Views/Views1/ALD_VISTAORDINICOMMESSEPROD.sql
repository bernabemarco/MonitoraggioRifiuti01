
CREATE VIEW [dbo].ALD_VISTAORDINICOMMESSEPROD AS
SELECT     TESTEORDINIPROD.TIPOCOM, TESTEORDINIPROD.TIPOCOM + '/' + CAST(TESTEORDINIPROD.ESERCIZIO AS varchar) 
                      + '/' + RIGHT('0000000000' + CAST(TESTEORDINIPROD.NUMEROCOM AS varchar), 10) + '/' + RIGHT('00000' + CAST(RIGHEORDPROD.IDRIGA AS varchar), 5) 
                      AS RIFORDINE, TESTEORDINIPROD.NUMEROCOM, TESTEORDINIPROD.ESERCIZIO, TESTEORDINIPROD.DATAEMISSIONE, TESTEORDINIPROD.PIANOPRODRIF, 
                      TESTEORDINIPROD.CODCLIENTE, TESTEORDINIPROD.ANNOTAZIONI, TESTEORDINIPROD.STATOCHIUSO, TESTEORDINIPROD.STATOBLOCCATO, 
                      RIGHEORDPROD.IDTESTA, RIGHEORDPROD.IDRIGA, RIGHEORDPROD.CODICEORD,
                          (SELECT     TIPOORDINE
                            FROM          PARAMETRIORDPROD
                            WHERE      (CODICE = RIGHEORDPROD.CODICEORD)) AS TIPOORD, RIGHEORDPROD.CODART AS CODARTORD, RIGHEORDPROD.DESCRIZIONEART, 
                      RIGHEORDPROD.VERSIONEDBA, RIGHEORDPROD.VERSIONECICLO, RIGHEORDPROD.UMGEST, RIGHEORDPROD.QTAGESTIONE, 
                      RIGHEORDPROD.QTAGESTIONEVERS, RIGHEORDPROD.QTAGESTIONERES, RIGHEORDPROD.QTAPREZZO, RIGHEORDPROD.UMPREZZO, 
                      RIGHEORDPROD.QTA1MAG, RIGHEORDPROD.QTA2MAG, RIGHEORDPROD.QTA1MAGRES, RIGHEORDPROD.QTA2MAGRES, RIGHEORDPROD.QTASCARTO, 
                      RIGHEORDPROD.UMSCARTO, 
                      (CASE WHEN RIGHEORDPROD.QTAGESTIONE <> 0 THEN RIGHEORDPROD.QTAGESTIONEVERS / RIGHEORDPROD.QTAGESTIONE * 100 ELSE 0 END) AS AVANZQTA, 
                      (CASE WHEN RIGHEORDPROD.COSTOTOTORDPREV <> 0 THEN RIGHEORDPROD.COSTOTOTORDEFF / RIGHEORDPROD.COSTOTOTORDPREV * 100 ELSE 0 END) 
                      AS AVANZCOSTI, RIGHEORDPROD.IDCOSTOSTD, RIGHEORDPROD.RifCommCli, RIGHEORDPROD.UM1MAG AS UM1, RIGHEORDPROD.UM2MAG AS UM2, 
                      RIGHEORDPROD.CODCLIDEST, RIGHEORDPROD.PARTITAASSEGNATA, RIGHEORDPROD.PARTITAVINCOLATA, RIGHEORDPROD.CODFORDEST, 
                      RIGHEORDPROD.DATAEMISSIONE AS DATAEMISSIONEORD, RIGHEORDPROD.TIPOSCHEDULAZIONE, RIGHEORDPROD.STATOORDINE, 
                      RIGHEORDPROD.FASERILASCIO, RIGHEORDPROD.DATARILASCIO, RIGHEORDPROD.DATAINIZIOSCHED, RIGHEORDPROD.DATAFINESCHED, 
                      RIGHEORDPROD.DATAINIZIORICH, ISNULL(RIGHEORDPROD.DATAFINERICH, RIGHEORDPROD.DATAINIZIORICH) AS DATAFINERICH, 
                      RIGHEORDPROD.DATAINIZIOEFF, RIGHEORDPROD.DATAFINEEFF, RIGHEORDPROD.DATAULTATTIVITA, 
                      CASE WHEN RIGHEORDPROD.DATAFINESCHED > RIGHEORDPROD.DATAFINERICH THEN datediff(day, RIGHEORDPROD.DATAFINERICH, 
                      RIGHEORDPROD.DATAFINESCHED) ELSE 0 END AS RITARDO, RIGHEORDPROD.CAUSALEMAG, RIGHEORDPROD.DEPOSITO, RIGHEORDPROD.UBICAZIONE, 
                      RIGHEORDPROD.CONTOCDC, RIGHEORDPROD.CAUSALEMAGCOLL, RIGHEORDPROD.DEPOSITOCOLL, RIGHEORDPROD.UBICAZIONECOLL, 
                      RIGHEORDPROD.CONTOCDCCOLL, RIGHEORDPROD.VALOREPRIORITA, RIGHEORDPROD.RAPPORTOCRITICO, RIGHEORDPROD.SLACKTIME, 
                      RIGHEORDPROD.COSTOMATPREV, RIGHEORDPROD.COSTOLAVINTPREV, RIGHEORDPROD.COSTOLAVESTPREV, RIGHEORDPROD.COSTOINDPREV, 
                      RIGHEORDPROD.COSTOUNITORDPREV, RIGHEORDPROD.COSTOTOTORDPREV, RIGHEORDPROD.COSTOMATPREVEURO, 
                      RIGHEORDPROD.COSTOLAVINTPREVEURO, RIGHEORDPROD.COSTOLAVESTPREVEURO, RIGHEORDPROD.COSTOINDPREVEURO, 
                      RIGHEORDPROD.COSTOUNITORDPREVEURO, RIGHEORDPROD.COSTOTOTORDPREVEURO, RIGHEORDPROD.DATACALCCSTPREV, RIGHEORDPROD.COSTOMATEFF,
                       RIGHEORDPROD.COSTOLAVINTEFF, RIGHEORDPROD.COSTOLAVESTEFF, RIGHEORDPROD.COSTOINDEFF, RIGHEORDPROD.COSTOUNITORDEFF, 
                      RIGHEORDPROD.COSTOTOTORDEFF, RIGHEORDPROD.COSTOMATEFFEURO, RIGHEORDPROD.COSTOLAVINTEFFEURO, RIGHEORDPROD.COSTOLAVESTEFFEURO, 
                      RIGHEORDPROD.COSTOINDEFFEURO, RIGHEORDPROD.COSTOUNITORDEFFEURO, RIGHEORDPROD.COSTOTOTORDEFFEURO, 
                      RIGHEORDPROD.DATACALCCSTEFF, RIGHEORDPROD.NOTE, VISTAANAGRAFICAARTICOLI.GRUPPO, VISTAANAGRAFICAARTICOLI.CATEGORIA, 
                      VISTAANAGRAFICAARTICOLI.VARESPLICITE, VISTAANAGRAFICAARTICOLI.TIPOGESTIONE, RIGHEORDPROD.STATOLANCIO, RIGHEORDPROD.STATOSTAMPA, 
                      RIGHEORDPROD.DATALANCIO, RIGHEORDPROD.QTAEMESSADOC, 
                      (CASE WHEN RIGHEORDPROD.QTAGESTIONE - RIGHEORDPROD.QTAEMESSADOC > 0 THEN RIGHEORDPROD.QTAGESTIONE - RIGHEORDPROD.QTAEMESSADOC ELSE
                       0 END) AS QTADAEMETTEREDOC, RIGHEORDPROD.RIFDOCUMENTO, VISTAANAGRAFICAARTICOLI.MOVIMENTAPARTITE, RIGHEORDPROD.STATOSTAMPACICLO, 
                      RIGHEORDPROD.DATAMODIFICA, ExtraCommCli.ResponsabileCommessa, ExtraCommCli.RefCoordComm
FROM         ExtraCommCli RIGHT OUTER JOIN
                      AnagraficaCommesse RIGHT OUTER JOIN
                      TESTEORDINIPROD ON AnagraficaCommesse.RifComm = TESTEORDINIPROD.RIFCOMMCLI LEFT OUTER JOIN
                      RIGHEORDPROD LEFT OUTER JOIN
                      VISTAANAGRAFICAARTICOLI ON VISTAANAGRAFICAARTICOLI.CODICE = RIGHEORDPROD.CODART ON 
                      TESTEORDINIPROD.PROGRESSIVO = RIGHEORDPROD.IDTESTA ON ExtraCommCli.RifProgressivo = AnagraficaCommesse.Progressivo


GO
GRANT DELETE
    ON OBJECT::[dbo].[ALD_VISTAORDINICOMMESSEPROD] TO [Metodo98]
    AS [dbo];


GO
GRANT INSERT
    ON OBJECT::[dbo].[ALD_VISTAORDINICOMMESSEPROD] TO [Metodo98]
    AS [dbo];


GO
GRANT REFERENCES
    ON OBJECT::[dbo].[ALD_VISTAORDINICOMMESSEPROD] TO [Metodo98]
    AS [dbo];


GO
GRANT SELECT
    ON OBJECT::[dbo].[ALD_VISTAORDINICOMMESSEPROD] TO [Metodo98]
    AS [dbo];


GO
GRANT UPDATE
    ON OBJECT::[dbo].[ALD_VISTAORDINICOMMESSEPROD] TO [Metodo98]
    AS [dbo];

