create view VISTACLIFORPROGPROD as
select 
	NOMEPIANIF,
	CODFOR as CODCLIFOR,
	(select DSCCONTO1 from ANAGRAFICACF CF where CF.CODCONTO=PRG1.CODFOR) as RAGSOCCLIFOR
from PROGPRODUZIONE PRG1
where CODFOR<>''

union all

select 
	NOMEPIANIF,
	RD.CODCLIDEST as CODCLIFOR,
	(select DSCCONTO1 from ANAGRAFICACF CF where CF.CODCONTO=RD.CODCLIDEST) as RAGSOCCLIFOR
from 
	PROGPRODUZIONE PRG2 
	left outer join RIGHEORDPROD RD on RD.IDTESTA = PRG2.IDTESTADOC and RD.IDRIGA = PRG2.IDRIGADOC
where PRG2.TIPO=6

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTACLIFORPROGPROD] TO [Metodo98]
    AS [dbo];

