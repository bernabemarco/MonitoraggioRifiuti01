

/******************************
Autore: Sara
Data: 14-6-2018
Usato da: lqprvg90.rpt
Commessa: Punto 155
Descrizione: 

Parametri: 
Modifiche (chi, quando, cosa):
*******************************/
CREATE VIEW [dbo].[ALD_VISTASCADENZE_PRovv] AS
SELECT 
    TS.PROGRESSIVO,
    TS.ESERCIZIO,
    TS.ANNODOC,
    TS.TIPODOC,
    TS.NUMDOC,
    TS.BIS,
    TS.NUMSCAD,
    TS.DATASCADENZA,
    TS.DATAFATTURA,
	(CASE WHEN ((TS.SCADATTPASS<>0 AND SUBSTRING(TS.CODCLIFOR,1,1)='F') OR(TS.SCADATTPASS=0 AND SUBSTRING(TS.CODCLIFOR,1,1)<>'F')) THEN(TS.IMPPROVEURO1*-1) ELSE TS.IMPPROVEURO1 END) as IMPPROVEURO1,
    (CASE WHEN TS.LIQPROV1 = 0 then 'Da liq.' when TS.LIQPROV1 = 1 then 'liquid.' END ) as LIQPROV1,
    TS.TOTFATTEURO,
    TS.FLAGCONT,
    TS.ESITO,
    TS.LIVSOLL,
    TS.LIQINS1,
    TS.DATAPAGEFF,
    (CASE WHEN ((TS.SCADATTPASS<>0 AND SUBSTRING(TS.CODCLIFOR,1,1)='F') OR(TS.SCADATTPASS=0 AND SUBSTRING(TS.CODCLIFOR,1,1)<>'F')) THEN(TS.IMPONIBSCEURO*-1) ELSE TS.IMPONIBSCEURO END) AS IMPONIBSCADEURO,
    (CASE WHEN ((TS.SCADATTPASS<>0 AND SUBSTRING(TS.CODCLIFOR,1,1)='F') OR(TS.SCADATTPASS=0 AND SUBSTRING(TS.CODCLIFOR,1,1)<>'F')) THEN(TS.IMPORTOSCEURO*-1) ELSE TS.IMPORTOSCEURO END) AS IMPORTOSCADEURO,
    (CASE WHEN ((TS.SCADATTPASS<>0 AND SUBSTRING(TS.CODCLIFOR,1,1)='F') OR(TS.SCADATTPASS=0 AND SUBSTRING(TS.CODCLIFOR,1,1)<>'F')) THEN(TS.IMPORTOSCVAL*-1) ELSE TS.IMPORTOSCVAL END) AS IMPORTOSCADVALUTA,
    (CASE WHEN ((TS.SCADATTPASS<>0 AND SUBSTRING(TS.CODCLIFOR,1,1)='F') OR(TS.SCADATTPASS=0 AND SUBSTRING(TS.CODCLIFOR,1,1)<>'F')) THEN(TS.TOTFATTEURO*-1) ELSE TS.TOTFATTEURO END) AS TOTFATTURAEURO,
    (CASE WHEN ((TS.SCADATTPASS<>0 AND SUBSTRING(TS.CODCLIFOR,1,1)='F') OR(TS.SCADATTPASS=0 AND SUBSTRING(TS.CODCLIFOR,1,1)<>'F')) THEN(TS.IMPFATTEURO*-1) ELSE TS.IMPFATTEURO END) AS IMPFATTURAEURO,
    (CASE WHEN ((TS.SCADATTPASS<>0 AND SUBSTRING(TS.CODCLIFOR,1,1)='F') OR(TS.SCADATTPASS=0 AND SUBSTRING(TS.CODCLIFOR,1,1)<>'F')) THEN(TS.IMPPROVEURO1*-1) ELSE TS.IMPPROVEURO1 END) AS IMPPROVSGNEURO1,

    ES.DESCRIZIONE AS DSCESITO,

	(CASE WHEN TS.ScadAttPass =1  then '' when TS.ScadAttPass =0 then 'Da Detrarre' END) as DaDetrar,
	TABPAGAMENTI.DESCRIZIONE as DESPAG,TS.CODPAG
    FROM 
        TABSCADENZE TS 
  
        LEFT OUTER JOIN ESITI ES   ON ES.ESITO=TS.ESITO
		LEFT OUTER JOIN TABPAGAMENTI   ON TABPAGAMENTI.CODICE=TS.CODPAG






GO
GRANT DELETE
    ON OBJECT::[dbo].[ALD_VISTASCADENZE_PRovv] TO [Metodo98]
    AS [dbo];


GO
GRANT INSERT
    ON OBJECT::[dbo].[ALD_VISTASCADENZE_PRovv] TO [Metodo98]
    AS [dbo];


GO
GRANT REFERENCES
    ON OBJECT::[dbo].[ALD_VISTASCADENZE_PRovv] TO [Metodo98]
    AS [dbo];


GO
GRANT SELECT
    ON OBJECT::[dbo].[ALD_VISTASCADENZE_PRovv] TO [Metodo98]
    AS [dbo];


GO
GRANT UPDATE
    ON OBJECT::[dbo].[ALD_VISTASCADENZE_PRovv] TO [Metodo98]
    AS [dbo];

