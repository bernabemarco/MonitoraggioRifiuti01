

CREATE VIEW TP_VISTADOCPRESEL
AS

(

SELECT DOCMISS,CODCONTO,NUMDDM  FROM
TabTesteTipoDocConsMiss INNER JOIN TabRigheTipoDocConsMiss
ON TabTesteTipoDocConsMiss.PROGRESSIVO=TabRigheTipoDocConsMiss.RIFPROGRESSIVO
WHERE DOCMISS IN
(SELECT  PDC.CODICE 
	FROM PARAMETRIDOC PDC INNER JOIN  TABUTENTI ON USERDB = USER_NAME()
	WHERE (SUPERVISOR = 1 OR 
    	(SUPERVISOR = 0 AND USERID IN (SELECT NOMEUTENTE FROM ACCESSIDOCUMENTI WHERE CODDOCUMENTO = PDC.CODICE AND FLAGABILITA=1))))
)

UNION

(
 
 SELECT DOCCONS,CODCONTO,NUMDDM FROM
 TabTesteTipoDocConsMiss INNER JOIN TabRigheTipoDocConsMiss
 ON TabTesteTipoDocConsMiss.PROGRESSIVO=TabRigheTipoDocConsMiss.RIFPROGRESSIVO
 WHERE DOCCONS IN
 (SELECT  PDC.CODICE 
	FROM PARAMETRIDOC PDC INNER JOIN  TABUTENTI ON USERDB = USER_NAME()
	WHERE (SUPERVISOR = 1 OR 
    	(SUPERVISOR = 0 AND USERID IN (SELECT NOMEUTENTE FROM ACCESSIDOCUMENTI WHERE CODDOCUMENTO = PDC.CODICE AND FLAGABILITA=1))))
)




GO
GRANT DELETE
    ON OBJECT::[dbo].[TP_VISTADOCPRESEL] TO [Metodo98]
    AS [dbo];


GO
GRANT INSERT
    ON OBJECT::[dbo].[TP_VISTADOCPRESEL] TO [Metodo98]
    AS [dbo];


GO
GRANT REFERENCES
    ON OBJECT::[dbo].[TP_VISTADOCPRESEL] TO [Metodo98]
    AS [dbo];


GO
GRANT SELECT
    ON OBJECT::[dbo].[TP_VISTADOCPRESEL] TO [Metodo98]
    AS [dbo];


GO
GRANT UPDATE
    ON OBJECT::[dbo].[TP_VISTADOCPRESEL] TO [Metodo98]
    AS [dbo];

