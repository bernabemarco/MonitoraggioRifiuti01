

CREATE VIEW VISTA_CONTRATTI_C_DECPROVV
AS
SELECT     T.TIPODOC AS TIPODOCEMESSO, T.ESERCIZIO, T.NUMERODOC, T.PROGRESSIVO AS PROGRESSIVODOC, CON.RIFCONTRATTO AS CONTRATTO, 
                      CON.PROGRESSIVO AS CONTRIBUTO, SUM(R.TOTPROVVAGEURO1) AS PROVVAG1, SUM(R.TOTPROVVAGEURO2) AS PROVVAG2, 
                      SUM(R.TOTPROVVAGEURO3) AS PROVVAG3
FROM         dbo.CONTRATTICC_DATELIQ AS C INNER JOIN
                      dbo.TESTEDOCUMENTI AS T ON T.PROGRESSIVO = C.RIFPROGRESSIVODOC INNER JOIN
                      dbo.RIGHEDOCUMENTI AS R ON R.IDTESTA = T.PROGRESSIVO INNER JOIN
                      dbo.CONTRATTI_CON AS CON ON CON.RIFCONTRATTO = C.RIFPROGRESSIVO AND C.RIFPROGRESSIVOCC = CON.PROGRESSIVO INNER JOIN
                      dbo.TESTE_CONTRATTI AS TESTE ON TESTE.PROGRESSIVO = CON.RIFCONTRATTO
WHERE     (CON.PRCAG1 = 1) AND (CON.LiquidaPerArticolo = 0) OR
                      (CON.LiquidaPerArticolo = 0) AND (CON.PRCAG2 = 1) OR
                      (CON.LiquidaPerArticolo = 0) AND (CON.PRCAG3 = 1)
GROUP BY T.TIPODOC, T.ESERCIZIO, T.NUMERODOC, T.PROGRESSIVO, CON.RIFCONTRATTO, CON.PROGRESSIVO


GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTA_CONTRATTI_C_DECPROVV] TO [Metodo98]
    AS [dbo];

