create view ACQ_VISTAOFFERTE as 
	select 
		(cast(T.ESERCIZIO as varchar(4)) + '/' + right('00000' + cast(T.NUMEROOFFERTA as varchar(10)),8)) as RIFOFFERTA,
		T.PROGRESSIVO,T.ESERCIZIO,T.NUMEROOFFERTA,T.DATAEMISSIONE,
		T.FORNITORE,(select DSCCONTO1 from ANAGRAFICACF where ANAGRAFICACF.CODCONTO=FORNITORE) as RAGSOCFORN,
		T.GRUPPOACQ,R.IDRIGA,R.ARTICOLO,(select DESCRIZIONE from ANAGRAFICAARTICOLI ART where ART.CODICE=R.ARTICOLO) as DSCARTICOLO,
		R.UM,R.QTAMINIMA,R.PREZZO,
		(select sum(QTAPRENOTATA) from ACQ_DETTAGLIOOFFERTA DETT where DETT.RIFPROGRESSIVO=T.PROGRESSIVO and DETT.RIFRIGA=R.IDRIGA) as QTAORDINATA,
		(select sum(TOTALEPRENOTATO) from ACQ_DETTAGLIOOFFERTA DETT where DETT.RIFPROGRESSIVO=T.PROGRESSIVO and DETT.RIFRIGA=R.IDRIGA) as TOTALEOFFERTA
	from 
		ACQ_TESTAOFFERTA T inner join ACQ_RIGHEOFFERTA R
		on T.PROGRESSIVO=R.RIFPROGRESSIVO

GO
GRANT SELECT
    ON OBJECT::[dbo].[ACQ_VISTAOFFERTE] TO [Metodo98]
    AS [dbo];

