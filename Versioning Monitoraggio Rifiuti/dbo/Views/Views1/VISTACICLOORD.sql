


/*
    RIF.S#3747 - aggiunto campo FLGCICLOCTRASF
*/
CREATE VIEW [dbo].[VISTACICLOORD] AS
SELECT 
    TCO.PROGRESSIVO
    ,TCO.CODCICLO
    ,TCO.VERSIONECICLO
    ,TCO.DSCVERSIONE
    ,TCO.STATOVERSIONE
    ,TCO.VALIDITACICLO
    ,TCO.VERSIONEDBA
    ,TCO.CICLOSTANDARD
    ,TCO.NOTECICLO
    ,TCO.UM
    ,TCO.QUANTITARIF
    ,TCO.TIPOCICLO
    ,TCO.IDTESTACOMM
    ,TCO.IDRIGACOMM
    ,TCO.LOTTOASSEGNATO
    ,TCO.DATAINIZIOLAV
    ,TCO.TIPOVALUTAZIONE
    ,TCO.FLGCICLOCTRASF
    ,STSV.DESCRIZIONE AS DSCSTATOVERSIONE
    ,(CASE WHEN RIGHT(CODCICLO, 1) = '#' THEN 
        (SELECT DESCRIZIONE FROM ANAGRAFICAARTICOLI WHERE CODICE = SUBSTRING(TCO.CODCICLO, 1, CHARINDEX('#', TCO.CODCICLO) - 1)) 
    ELSE
        (SELECT DESCRIZIONE FROM ANAGRAFICAARTICOLI WHERE CODICE = TCO.CODCICLO) END) AS DSCCODCICLO,
    COM.TIPOCOM+'/'+cast(COM.ESERCIZIO as varchar)+'/'+right('0000000000'+cast(COM.NUMEROCOM as varchar),10)+'/'+right('00000'+cast(TCO.IDRIGACOMM as varchar),5) as RIFORDINE
    ,STSV.USAVERSIONE
    ,DAC.VALIDITADBA
    ,DAC.DBASTANDARD
FROM TESTACICLOORDINE TCO 
    LEFT OUTER JOIN TABSTATOVERSIONECICLO STSV ON TCO.STATOVERSIONE = STSV.CODICE
    LEFT OUTER JOIN DISTINTAARTCOMPOSTI DAC ON TCO.CODCICLO=DAC.ARTCOMPOSTO AND TCO.VERSIONEDBA=DAC.VERSIONEDBA
    LEFT OUTER JOIN TESTEORDINIPROD COM ON COM.PROGRESSIVO=TCO.IDTESTACOMM

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTACICLOORD] TO [Metodo98]
    AS [dbo];

