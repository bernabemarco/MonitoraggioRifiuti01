
CREATE FUNCTION [dbo].[MB_FunGetCausaliValide]( )
RETURNS TABLE 
--ENCRY--
AS
RETURN
(
	SELECT 
		0 AS TIPO,
		MAD.CODDOCUMENTO,
		MAD.CODCAUSALE 
	FROM 
		MB_ACQUISTATO_DOCUMENTI MAD
	
	UNION
	SELECT
		1 AS TIPO,
		'' AS CODDOCUMENTO,
		TCM.CODICE AS CODCAUSALE
	FROM 
		TABCAUSALIMAG TCM
	WHERE
		TCM.VALORECARICO = 1 AND TCM.CLIFOR = 'F'
	union all
	SELECT 
		0 AS TIPO,
		'' TIPODOC,
		MAD.CODICE 
	FROM TABCAUSALIMAG MAD
	WHERE VALORECARICO =1 
	
	AND NOT EXISTS(SELECT 
		0 AS TIPO,
		MAD.CODDOCUMENTO,
		MAD.CODCAUSALE 
	FROM 
		MB_ACQUISTATO_DOCUMENTI MAD
	
	UNION
	SELECT
		1 AS TIPO,
		'' AS CODDOCUMENTO,
		TCM.CODICE AS CODCAUSALE
	FROM 
		TABCAUSALIMAG TCM
	WHERE
		TCM.VALORECARICO = 1 AND TCM.CLIFOR = 'F')	
)



GO
GRANT SELECT
    ON OBJECT::[dbo].[MB_FunGetCausaliValide] TO [Metodo98]
    AS [dbo];

