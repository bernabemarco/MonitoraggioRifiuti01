




/*
	rif.08/03/2016 - aggiunti parametri CICLO_DISPRISORSE e CICLO_INDICECAPACITA che sovrascrivono i valori di CDL e RIS
*/
CREATE FUNCTION [dbo].[CALCOLAINDICECARICOFASE](
    @CDL_DISPRISORSE        SMALLINT
    ,@CDL_DISPRISORSECM     SMALLINT
	,@CICLO_DISPRISORSE		SMALLINT
    ,@RIS_INDICECAPACITA    SMALLINT
    ,@RIS_INDICECAPACITACM  SMALLINT
	,@CICLO_INDICECAPACITA	SMALLINT
) RETURNS DECIMAL(20,10)
BEGIN
    
    DECLARE @RESULT DECIMAL(20,10);
    DECLARE @IC SMALLINT;
    DECLARE @CM SMALLINT;

    --calcolo indice di carico
	SET @IC = @CICLO_INDICECAPACITA;
	IF (@IC = 0)
	BEGIN
		SET @IC = @RIS_INDICECAPACITA;
	END
	IF (@IC = 0)
	BEGIN
		SET @CM = @CICLO_DISPRISORSE;
	END
	IF (@IC = 0)
	BEGIN
		SET @IC = @CDL_DISPRISORSE;
	END

    --calcolo capacita' disponibile
	SET @CM = @RIS_INDICECAPACITACM;
    IF (@CM = 0)
    BEGIN
        SET @CM = @CDL_DISPRISORSECM;
    END

    --calcolo indice di carico
    SET @RESULT = 1;
    IF (@CM <> 0)
    BEGIN
        SET @RESULT = CAST(@IC AS DECIMAL(20,10)) / CAST(@CM AS DECIMAL(20,10));
    END
    RETURN @RESULT
    
END

GO
GRANT EXECUTE
    ON OBJECT::[dbo].[CALCOLAINDICECARICOFASE] TO [Metodo98]
    AS [dbo];

