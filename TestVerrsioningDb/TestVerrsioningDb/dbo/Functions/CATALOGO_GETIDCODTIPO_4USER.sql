

 CREATE FUNCTION [dbo].[CATALOGO_GETIDCODTIPO_4USER]
 (
 @Username varchar(100)
 )
 RETURNS TABLE
 AS
 RETURN
 (
 SELECT DISTINCT
 CATALOGO_ACCESSI_GRUPPO.ID,
 CODTIPO,
 0 S
 FROM
 dbo.TABUTENTI
 INNER JOIN
 dbo.TABMEMBRIGRUPPO
 ON
 dbo.TABUTENTI.USERID = dbo.TABMEMBRIGRUPPO.CODUTENTE
 INNER JOIN
 dbo.CATALOGO_ACCESSI_GRUPPO
 ON
 dbo.TABMEMBRIGRUPPO.CODGRUPPO = dbo.CATALOGO_ACCESSI_GRUPPO.GRUPPOID
 WHERE
 USERDB= @Username
 AND CATALOGO_ACCESSI_GRUPPO.FLAGABILITA =1
 UNION ALL
 SELECT
 ID,
 CODTIPO,
 0 S
 FROM
 CATALOGO_ACCESSI_UTENTE CAU
 WHERE
 CAU.USERDB= @Username
 AND CAU.FLAGABILITA =1
 UNION ALL
 SELECT
 0,
 0,
 SUPERVISOR S
 FROM
 TABUTENTI
 WHERE
 SUPERVISOR=1
 AND USERDB=@Username
 )

 
GO
GRANT SELECT
    ON OBJECT::[dbo].[CATALOGO_GETIDCODTIPO_4USER] TO [Metodo98]
    AS [dbo];

