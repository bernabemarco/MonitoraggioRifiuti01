

CREATE FUNCTION [dbo].[MB_FunRifRigheDocumenti]
(
    @IdSessione DECIMAL(5,0)
  
)
RETURNS TABLE AS RETURN
(
    SELECT        IDTESTA, IDRIGA, IDSESSIONE, RIFDSCCANALE, DATADOC

    FROM            MB_RIFRIGHEDOCUMENTI_TMP
    WHERE IDSESSIONE = @IdSessione
    UNION
    SELECT RD.IDTESTA,RD.idriga, @IdSessione IDSESSIONE,''  RIFDSCCANALE,TD.DATADOC

    FROM (SELECT CODICEDOC FROM MB_RAGGRUPPAMENTO_DOCUMENTI MB_RAGG_DOC 
    INNER JOIN dbo.MB_RAGGRUPPAMENTI MB_RAGGR 
        ON MB_RAGGR.CODICE = MB_RAGG_DOC.CODRAGGRUPPAMENTO
    WHERE MB_RAGGR.CODTIPO = 5  
        ) MB_RAGG_DOC

    INNER JOIN dbo.TESTEDOCUMENTI TD 
        ON TD.TIPODOC = MB_RAGG_DOC.CODICEDOC
    INNER JOIN dbo.RIGHEDOCUMENTI RD 
        ON TD.PROGRESSIVO = RD.IDTESTA  
    
)


GO
GRANT SELECT
    ON OBJECT::[dbo].[MB_FunRifRigheDocumenti] TO [Metodo98]
    AS [dbo];

