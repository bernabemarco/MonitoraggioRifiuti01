
CREATE FUNCTION [dbo].[FunORDINATO_DATAPROSSIMA](@ARTICOLO nVARCHAR(50),
												  @MAGAZZINO nVARCHAR(10),
												   @DATACONFRONTO DATETIME)

RETURNS DATETIME
AS
BEGIN   

DECLARE @DATAORDINATO			AS DATETIME

	SELECT TOP 1
		@DATAORDINATO = DATAMOV
	FROM
	(
		SELECT 
			DATAMOV,
			ABS(DATEDIFF(d,@DATACONFRONTO,DATAMOV)) AS DIFF
		FROM 
			STORICOMAG 
		WHERE 
			CODART = @ARTICOLO AND 
			CODDEPOSITO = @MAGAZZINO AND
			ORDINATO = 1
	) DATAPROSSIMA
	ORDER BY DIFF

RETURN(@DATAORDINATO)

END


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[FunORDINATO_DATAPROSSIMA] TO [Metodo98]
    AS [dbo];


GO
GRANT REFERENCES
    ON OBJECT::[dbo].[FunORDINATO_DATAPROSSIMA] TO [Metodo98]
    AS [dbo];

