CREATE VIEW VISTAORDPRODNAV
  AS SELECT
  	2 AS ORIGINE,
  	TC.PROGRESSIVO IDTESTA,RO.IDRIGA,0 AS IDIMPEGNO,
	TC.ESERCIZIO,TC.TIPOCOM AS TIPO,TC.NUMEROCOM AS NUMERO,'' AS BIS,
  	TC.DATAEMISSIONE,
  	TC.CODCLIENTE AS CODCLIFOR,
  	(SELECT DSCCONTO1 FROM AnagraficaCF WHERE AnagraficaCF.CodConto=TC.CODCLIENTE) AS RagSocCliFor,
  	RO.CODART,RO.DESCRIZIONEART,
  	RO.DATAFINERICH AS DATACONSEGNA,
  	RO.UMGEST, RO.QTAGESTIONE, RO.QTAGESTIONERES, RO.QTAGESTIONEVERS, 
  	RO.UMPREZZO,RO.QTAPREZZO,RO.QTAPREZZORES,
  	(SELECT UM FROM ARTICOLIUMPREFERITE AUM WHERE AUM.CODART = RO.CODART AND AUM.TIPOUM = 1) UM1MAG,
	RO.QTA1MAG,RO.QTA1MAGRES,
	(SELECT UM FROM ARTICOLIUMPREFERITE AUM WHERE AUM.CODART = RO.CODART AND AUM.TIPOUM = 2) UM2MAG,
	RO.QTA2MAG,RO.QTA2MAGRES,
	RO.PARTITAASSEGNATA, 	
	RO.DEPOSITO AS CODDEPOSITO,RO.DEPOSITOCOLL AS CODDEPOSITOCOLL,
	RO.UBICAZIONE,RO.UBICAZIONECOLL,
	RO.COSTOUNITORDPREV AS COSTOUNITARIO,
	RO.COSTOUNITORDPREVEURO AS COSTOUNITARIOEURO,
	RO.COSTOTOTORDPREV AS COSTOTOTALE,
	RO.COSTOTOTORDPREVEURO AS COSTOTOTALEEURO
FROM
	TESTEORDINIPROD TC, RIGHEORDPROD RO
WHERE
	TC.PROGRESSIVO = RO.IDTESTA

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAORDPRODNAV] TO [Metodo98]
    AS [dbo];

