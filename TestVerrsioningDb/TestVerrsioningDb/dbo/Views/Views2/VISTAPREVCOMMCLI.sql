CREATE VIEW VISTAPREVCOMMCLI AS 
SELECT
	TF.PROGRESSIVO,
	TF.RIFCOMMESSA,
	TF.ESERCIZIO,
	TF.TIPO,
	TF.NUMERO,
	TF.REVISIONE,
	TR.DESCRIZIONE AS DESREVISIONE,
	TF.RIFERIMENTO,
	TF.STATO,
	TF.OGGETTO,
	TF.CODCLIENTE,
	TF.CLIENTEFATT,
	TF.DATAFINE,
	TF.RIFSTRUTTURA,
	TF.NRLIVELLISTRUTT,
	TF.FILESCRIPT_DATACOSTI,
	TF.DATARIFPREZZIPART,
	TF.DOCOFFERTA,
	RF.NRRIGA,
	RF.POSIZIONE,
	RF.POSIZIONENODO,
	RF.FLAGRIGA,
	RF.TIPONODO,
	RF.CODLIVELLO,
	RF.CODLIVS1,
	RF.LIVS1,
	RF.LIVPADRES1,
	RF.LIV5,
	RF.DESCRIZIONE,
	RF.VOCECOSTO,
	RF.VERSDBA,
	RF.UMGEST,
	RF.QTAGESTIONE,
	RF.QTARILASCIATA,
	(CASE WHEN (RF.QTAGESTIONE-RF.QTARILASCIATA) > 0 THEN (RF.QTAGESTIONE-RF.QTARILASCIATA) ELSE 0 END) AS QTADARIL,
	RF.QTAFATTURATA,
	(CASE WHEN (RF.QTAGESTIONE-RF.QTAFATTURATA) > 0 THEN (RF.QTAGESTIONE-RF.QTAFATTURATA) ELSE 0 END) AS QTADAFATT,
	RF.IMPORTOFATTEURO,
	RF.UMCOSTO,
	RF.QTACOSTO,
	RF.FATTCONV,
	RF.COSTOUNITARIO,
	RF.COSTOUNITARIOEURO,
	RF.COSTOTOTALEPREV,
	RF.COSTOTOTALEPREVEURO,
	RF.UMPREZZO,
	RF.QTAPREZZO,
	RF.FATTCONVPR,
	RF.PREZZOFFERTAUNI,
	RF.PREZZOFFERTAUNIEURO,
	RF.PREZZOFFERTATOT,
	RF.PREZZOFFERTATOTEURO,
	RF.DATAINIPREV,
	RF.DATAFINEPREV,
	RF.DATACOSTOPREV,
	RF.FLGTIPOLIV5,
	RF.FLGARTICOLOVALIDO,
	RF.NOTE,
	RF.TIPOVALCOSTO,
	RF.LISTINO,
	RF.LISTINOFOR,
	RF.FORNITORE,
	RF.COSTOSTD,
	RF.FLGUSAPZP,
	RF.FLGUSASCONTIFOR,
	RF.AGENTECOSTO,
	RF.FORMULAOFFERTA,
	RF.FLGBLOCCACOSTO,
	RF.FLGBLOCCAPREZZO,
	RF.FLGOPZIONE
FROM
	(TESTEFOGLICOMMCLI TF INNER JOIN TABREVISIONICOMMCLI TR ON TF.REVISIONE = TR.CODICE) 
	INNER JOIN RIGHEPREVCOMMCLI RF ON TF.PROGRESSIVO=RF.RIFPROGRESSIVO

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAPREVCOMMCLI] TO [Metodo98]
    AS [dbo];

