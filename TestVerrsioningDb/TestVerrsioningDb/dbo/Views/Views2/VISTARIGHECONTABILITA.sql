CREATE VIEW VISTARIGHECONTABILITA AS
SELECT RCONT.NRREG,RCONT.NRRIGA,TCONT.PROGRESSIVO,
    TCONT.ESERCIZIO,
    TCONT.DATAREG,
    TCONT.NRRIFER,
    TCONT.PROVVISORIO,
    TCONT.MOVIVA,
    TCONT.CAUSALE,
    TCONT.MESEPLAFOND,
    TCONT.DESCRIZIONE,
    TCONT.APPUNTI,
    TCONT.TOTDOCLIRE,
    TCONT.TOTDOCVALUTA,
    TCONT.TOTDOCEURO,
    TCONT.NRGIORNALE,
    RCONT.DATARIF,
    RCONT.NRRIF,
    RCONT.NRPARTITA,
    RCONT.CONTO,
    RCONT.SEGNO,
    RCONT.IMPORTO,RCONT.IMPORTOVALUTA,
    RCONT.IMPORTOEURO,
    RCONT.VALORECAMBIO,
    RCONT.DESCRIZIONE AS DESCRIZIONERIGHE,
    RCONT.DATAVALUTA,
    RCONT.CPARTITA,RCONT.RIGACAUSALE,RCONT.CODCOMMESSA,
    RCONT.CODCAMBIO,
    (CASE WHEN RCONT.SEGNO=0 THEN RCONT.IMPORTO ELSE 0 END)  AS DARE,
    (CASE WHEN RCONT.SEGNO=0 THEN RCONT.IMPORTOEURO ELSE 0 END)  AS DAREEURO,
    (CASE WHEN RCONT.SEGNO=0 THEN RCONT.IMPORTOVALUTA ELSE 0 END)  AS DAREVALUTA,
    (CASE WHEN RCONT.SEGNO=1 THEN RCONT.IMPORTO ELSE 0 END)  AS AVERE,
    (CASE WHEN RCONT.SEGNO=1 THEN RCONT.IMPORTOEURO ELSE 0 END)  AS AVEREEURO,
    (CASE WHEN RCONT.SEGNO=1 THEN RCONT.IMPORTOVALUTA ELSE 0 END)  AS AVEREVALUTA
    FROM RIGHECONTABILITA RCONT, TESTECONTABILITA TCONT 
    WHERE  RCONT.NRREG=TCONT.PROGRESSIVO AND
    TCONT.CAUSALE<>(SELECT GIC.CAUSCONTAP FROM TABVINCOLIGIC GIC WHERE GIC.ESERCIZIO=TCONT.ESERCIZIO)
    AND TCONT.CAUSALE<>(SELECT GIC.CAUSCONTCH FROM TABVINCOLIGIC GIC WHERE GIC.ESERCIZIO=TCONT.ESERCIZIO)

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTARIGHECONTABILITA] TO [Metodo98]
    AS [dbo];

