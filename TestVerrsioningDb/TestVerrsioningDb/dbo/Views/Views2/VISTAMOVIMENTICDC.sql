CREATE VIEW VISTAMOVIMENTICDC AS
SELECT MOVCDC.PROGRESSIVO,
    MOVCDC.TIPOMOV,
    MOVCDC.IDRIFERIMENTO,
    MOVCDC.NRRIGA,
    MOVCDC.POSIZIONE,
    MOVCDC.CODCONTOCC,
    MOVCDC.CODGENERICO,
    MOVCDC.ANNO,
    MOVCDC.MESE,
    MOVCDC.CODCOMMESSA,
    MOVCDC.ESERCIZIO,
    MOVCDC.DATAREG,
    MOVCDC.DATARIF,
    MOVCDC.NUMDOC,
    MOVCDC.NUMRIF,
    MOVCDC.PRCRIPARTIZIONE,
    MOVCDC.NOTE,
    MOVCDC.IDCDC,
    TESTECONTABILITA.MESEPLAFOND,
    TESTECONTABILITA.APPUNTI,
    TESTECONTABILITA.CAUSALE,
    TESTECONTABILITA.NRGIORNALE,
    (CASE WHEN TESTECONTABILITA.PROVVISORIO IS NULL THEN 0 ELSE TESTECONTABILITA.PROVVISORIO END) AS PROVVISORIO,
    (CASE WHEN MOVCDC.SEGNO=0 THEN MOVCDC.IMPORTORIP ELSE 0 END) AS DARE,
    (CASE WHEN MOVCDC.SEGNO=0 THEN MOVCDC.IMPORTORIPEURO ELSE 0 END) AS DAREEURO,
    (CASE WHEN MOVCDC.SEGNO=1 THEN MOVCDC.IMPORTORIP ELSE 0 END) AS AVERE,
    (CASE WHEN MOVCDC.SEGNO=1 THEN MOVCDC.IMPORTORIPEURO ELSE 0 END) AS AVEREEURO,
    RIGHEIVA.NUMDOC AS NUMDOCIVA,
    RIGHEIVA.DATADOC AS DATADOC,
    RIGHEIVA.MESELIQUIDAZ AS MESELIQUIDAZ
    FROM (MOVIMENTICDC AS MOVCDC LEFT OUTER JOIN TESTECONTABILITA ON MOVCDC.IDRIFERIMENTO=TESTECONTABILITA.PROGRESSIVO) LEFT OUTER JOIN RIGHEIVA ON MOVCDC.IDRIFERIMENTO=RIGHEIVA.NRREG AND RIGHEIVA.NRRIGA=1 AND TESTECONTABILITA.MOVIVA=RIGHEIVA.TIPOREGISTRO

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAMOVIMENTICDC] TO [Metodo98]
    AS [dbo];

