CREATE VIEW VISTAORDINICOMMESSEPROD AS
SELECT TESTEORDINIPROD.TIPOCOM,
	TESTEORDINIPROD.TIPOCOM+'/'+cast(TESTEORDINIPROD.ESERCIZIO as varchar)+'/'+right('0000000000'+cast(TESTEORDINIPROD.NUMEROCOM as varchar),10)+'/'+right('00000'+cast(RIGHEORDPROD.IDRIGA as varchar),5) as RIFORDINE,
	TESTEORDINIPROD.NUMEROCOM,
	TESTEORDINIPROD.ESERCIZIO,
	TESTEORDINIPROD.DATAEMISSIONE,
	TESTEORDINIPROD.PIANOPRODRIF,
	TESTEORDINIPROD.CODCLIENTE,
	TESTEORDINIPROD.ANNOTAZIONI,
	TESTEORDINIPROD.STATOCHIUSO,
	TESTEORDINIPROD.STATOBLOCCATO,
	RIGHEORDPROD.IDTESTA,RIGHEORDPROD.IDRIGA,
	RIGHEORDPROD.CODICEORD,
	(select TIPOORDINE from PARAMETRIORDPROD where
	  PARAMETRIORDPROD.CODICE = RIGHEORDPROD.CODICEORD) as TIPOORD,
	RIGHEORDPROD.CODART as CODARTORD,
	RIGHEORDPROD.DESCRIZIONEART,
	RIGHEORDPROD.VERSIONEDBA,
	RIGHEORDPROD.VERSIONECICLO,
	RIGHEORDPROD.UMGEST,RIGHEORDPROD.QTAGESTIONE,
	RIGHEORDPROD.QTAGESTIONEVERS,
	RIGHEORDPROD.QTAGESTIONERES,
	RIGHEORDPROD.QTAPREZZO,
	RIGHEORDPROD.UMPREZZO,
	RIGHEORDPROD.QTA1MAG,
	RIGHEORDPROD.QTA2MAG,
	RIGHEORDPROD.QTA1MAGRES,
	RIGHEORDPROD.QTA2MAGRES,
	RIGHEORDPROD.QTASCARTO,
	RIGHEORDPROD.UMSCARTO,
	(case when RIGHEORDPROD.QTAGESTIONE <> 0 then RIGHEORDPROD.QTAGESTIONEVERS/RIGHEORDPROD.QTAGESTIONE*100 else 0 end) as AVANZQTA,
	(case when RIGHEORDPROD.COSTOTOTORDPREV <> 0 then RIGHEORDPROD.COSTOTOTORDEFF/RIGHEORDPROD.COSTOTOTORDPREV*100 else 0 end) as AVANZCOSTI,
	RIGHEORDPROD.IDCOSTOSTD,
	RIGHEORDPROD.RIFCOMMCLI,
	RIGHEORDPROD.UM1MAG as UM1,
	RIGHEORDPROD.UM2MAG as UM2,
	RIGHEORDPROD.CODCLIDEST,
	RIGHEORDPROD.PARTITAASSEGNATA,
	RIGHEORDPROD.PARTITAVINCOLATA,
	RIGHEORDPROD.CODFORDEST,
	RIGHEORDPROD.DATAEMISSIONE as DATAEMISSIONEORD,
	RIGHEORDPROD.TIPOSCHEDULAZIONE,
	RIGHEORDPROD.STATOORDINE,
	RIGHEORDPROD.FASERILASCIO,
	RIGHEORDPROD.DATARILASCIO,
	RIGHEORDPROD.DATAINIZIOSCHED,
	RIGHEORDPROD.DATAFINESCHED,
	RIGHEORDPROD.DATAINIZIORICH,
	isnull(RIGHEORDPROD.DATAFINERICH,RIGHEORDPROD.DATAINIZIORICH) as DATAFINERICH,
	RIGHEORDPROD.DATAINIZIOEFF,RIGHEORDPROD.DATAFINEEFF,
	RIGHEORDPROD.DATAULTATTIVITA,
	CASE WHEN RIGHEORDPROD.DATAFINESCHED>RIGHEORDPROD.DATAFINERICH THEN datediff(day,RIGHEORDPROD.DATAFINERICH,RIGHEORDPROD.DATAFINESCHED) ELSE 0 END as RITARDO,
	RIGHEORDPROD.CAUSALEMAG,RIGHEORDPROD.DEPOSITO,RIGHEORDPROD.UBICAZIONE,
	RIGHEORDPROD.CONTOCDC,RIGHEORDPROD.CAUSALEMAGCOLL,RIGHEORDPROD.DEPOSITOCOLL,
	RIGHEORDPROD.UBICAZIONECOLL,RIGHEORDPROD.CONTOCDCCOLL,
	RIGHEORDPROD.VALOREPRIORITA,RIGHEORDPROD.RAPPORTOCRITICO,
	RIGHEORDPROD.SLACKTIME,
	RIGHEORDPROD.COSTOMATPREV,RIGHEORDPROD.COSTOLAVINTPREV,
	RIGHEORDPROD.COSTOLAVESTPREV,RIGHEORDPROD.COSTOINDPREV,
	RIGHEORDPROD.COSTOUNITORDPREV,RIGHEORDPROD.COSTOTOTORDPREV,
	RIGHEORDPROD.COSTOMATPREVEURO,RIGHEORDPROD.COSTOLAVINTPREVEURO,
	RIGHEORDPROD.COSTOLAVESTPREVEURO,RIGHEORDPROD.COSTOINDPREVEURO,
	RIGHEORDPROD.COSTOUNITORDPREVEURO,RIGHEORDPROD.COSTOTOTORDPREVEURO,RIGHEORDPROD.DATACALCCSTPREV,
	RIGHEORDPROD.COSTOMATEFF,RIGHEORDPROD.COSTOLAVINTEFF,
	RIGHEORDPROD.COSTOLAVESTEFF,RIGHEORDPROD.COSTOINDEFF,
	RIGHEORDPROD.COSTOUNITORDEFF,RIGHEORDPROD.COSTOTOTORDEFF,
	RIGHEORDPROD.COSTOMATEFFEURO,RIGHEORDPROD.COSTOLAVINTEFFEURO,
	RIGHEORDPROD.COSTOLAVESTEFFEURO,RIGHEORDPROD.COSTOINDEFFEURO,
	RIGHEORDPROD.COSTOUNITORDEFFEURO,RIGHEORDPROD.COSTOTOTORDEFFEURO,RIGHEORDPROD.DATACALCCSTEFF,
	RIGHEORDPROD.NOTE,
	VISTAANAGRAFICAARTICOLI.GRUPPO,
	VISTAANAGRAFICAARTICOLI.CATEGORIA,
	VISTAANAGRAFICAARTICOLI.VARESPLICITE,
	VISTAANAGRAFICAARTICOLI.TIPOGESTIONE,
	RIGHEORDPROD.STATOLANCIO,
	RIGHEORDPROD.STATOSTAMPA,
	RIGHEORDPROD.DATALANCIO,
	RIGHEORDPROD.QTAEMESSADOC,
	(case when RIGHEORDPROD.QTAGESTIONE-RIGHEORDPROD.QTAEMESSADOC > 0 then RIGHEORDPROD.QTAGESTIONE-RIGHEORDPROD.QTAEMESSADOC else 0 end) as QTADAEMETTEREDOC,
	RIGHEORDPROD.RIFDOCUMENTO,
	VISTAANAGRAFICAARTICOLI.MOVIMENTAPARTITE,
	RIGHEORDPROD.STATOSTAMPACICLO,
	RIGHEORDPROD.DATAMODIFICA
FROM
	(TESTEORDINIPROD left outer join
	(RIGHEORDPROD left outer join VISTAANAGRAFICAARTICOLI on
	VISTAANAGRAFICAARTICOLI.CODICE = RIGHEORDPROD.CODART) on
	TESTEORDINIPROD.PROGRESSIVO = RIGHEORDPROD.IDTESTA)

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAORDINICOMMESSEPROD] TO [Metodo98]
    AS [dbo];

