
CREATE VIEW [dbo].[zzMargineVendite]
AS
SELECT	TIPODOC, DATADOC, CODCLIFOR, CODAGENTE1, CODART,
		PREZZOUNITNETTOEURO AS Prezzo,
		dbo.Z_Costo_Ultimo(CODART, DATADOC) AS Costo, 
		ROUND((PREZZOUNITNETTOEURO - dbo.Z_Costo_Ultimo(CODART, DATADOC)) / PREZZOUNITNETTOEURO * 100, 2) AS Marg
FROM	dbo.VISTADOCUMENTIBASE
WHERE	TIPODOC IN ('FVC', 'FVV', 'FVI')
	AND	CODART <> ''
	AND	PREZZOUNITNETTOEURO <> 0

GO
GRANT SELECT
    ON OBJECT::[dbo].[zzMargineVendite] TO [Metodo98]
    AS [dbo];

