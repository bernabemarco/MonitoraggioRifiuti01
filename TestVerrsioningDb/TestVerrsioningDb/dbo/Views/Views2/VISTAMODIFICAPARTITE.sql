CREATE VIEW VISTAMODIFICAPARTITE AS
SELECT RC.NRREG,RC.NRRIGA,RC.ESERCIZIO,RC.DATARIF,RC.NRPARTITA,RC.DATAREG,
    (CASE WHEN SEGNO=0 THEN IMPORTO ELSE 0 END) AS DARELIT,
    (CASE WHEN SEGNO=1 THEN IMPORTO ELSE 0 END) AS AVERELIT,
    (CASE WHEN SEGNO=0 THEN IMPORTOEURO ELSE 0 END) AS DAREEURO,
    (CASE WHEN SEGNO=1 THEN IMPORTOEURO ELSE 0 END) AS AVEREEURO,
    (CASE WHEN SEGNO=0 THEN IMPORTOVALUTA ELSE 0 END) AS DAREVALUTA,
    (CASE WHEN SEGNO=1 THEN IMPORTOVALUTA ELSE 0 END) AS AVEREVALUTA,
    RC.DATAVALUTA,RC.CPARTITA,RC.IMPORTOVALUTA,RC.CONTO,RC.CODCAMBIO,RC.VALORECAMBIO,
    (SELECT DESCRIZIONE FROM TESTECONTABILITA WHERE PROGRESSIVO=RC.NRREG) AS DESCRIZIONE,
    (SELECT DESCRIZIONE FROM CAUSALICONTABILI WHERE CODICECAUSALE=(SELECT CAUSALE FROM TESTECONTABILITA WHERE PROGRESSIVO=RC.NRREG)) AS DSCCAUSALE
    FROM RIGHECONTABILITA AS RC

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAMODIFICAPARTITE] TO [Metodo98]
    AS [dbo];

