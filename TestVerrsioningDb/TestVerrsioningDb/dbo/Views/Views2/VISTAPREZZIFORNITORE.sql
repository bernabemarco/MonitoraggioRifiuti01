create view [VISTAPREZZIFORNITORE] as
select 
	CF.CODCONTO,ART.CODICE as ARTICOLO,
	isnull(CF.LISTINO,0) as LISTINO,
	isnull(LST.UM,'') as UMLISTINO,
	isnull(LST.PREZZOEURO,0) as PREZZOLISTINO,
	isnull(STP.UM,'') as UMULTPREZZO,
	isnull(STP.PREZZOEURO,0) as ULTPREZZO
from ANAGRAFICAARTICOLI ART
	left outer join ANAGRAFICARISERVATICF CF on left(CF.CODCONTO,1)='F' and CF.LISTINO<>0 and CF.ESERCIZIO=(SELECT ESERCIZIOATTIVO FROM TABUTENTI WHERE USERDB = USER_NAME())
	left outer join LISTINIARTICOLI LST	on LST.NRLISTINO=CF.LISTINO and LST.CODART=ART.CODICE	
	left outer join STORICOPREZZIARTICOLO STP on STP.TIPOPREZZO='F' and STP.ULTIMO=1 and STP.CODCLIFOR=CF.CODCONTO and STP.CODARTICOLO=ART.CODICE

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAPREZZIFORNITORE] TO [Metodo98]
    AS [dbo];

