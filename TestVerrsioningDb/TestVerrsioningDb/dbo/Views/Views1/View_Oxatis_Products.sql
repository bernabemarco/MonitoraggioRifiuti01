
CREATE VIEW View_Oxatis_Products
AS
SELECT
    /*
	in caso di personalizzazioni non modificare questa vista standard
	creare una vista personalizzata View_Oxatis_Products_Pers 
	*/
    AA.CODICE
  , AA.DESCRIZIONE
  , AA.VARESPLICITE
  , AA.PESONETTO
  , AAC.BARCODESTRING
  , AAC.EXPORTECOMMERCE
  , AACParent.CODICEART AS PARENT
  , AACParent.EXPORTECOMMERCE AS PARENTEXPORTECOMMERCE
  , AAC.CODIVA
  , IVA.ALIQUOTA
  , AAC.ESERCIZIO
  , (SELECT TOP (1)
         DA.DESCRIZIONEAGG
     FROM
         DESCRARTICOLI AS DA
     WHERE
         DA.CODICEART = AAC.CODICEART
         AND DA.LINGUA = TABLINGUE.CODICE
     ORDER BY
         DA.DESCRIZIONEAGG) AS DESCRIZIONEAGG
  , (SELECT TOP (1)
         DA.INFORMAZIONIAGG
     FROM
         DESCRARTICOLI AS DA
     WHERE
         DA.CODICEART = AAC.CODICEART
         AND DA.LINGUA = TABLINGUE.CODICE
     ORDER BY
         DA.INFORMAZIONIAGG) AS INFORMAZIONIAGG
  , TABLINGUE.CODICE AS LINGUA
  , AA.DATAMODIFICA
  , G.DESCRIZIONE AS CATEGORIA_1_DESCRIZIONE
  , C.DESCRIZIONE AS CATEGORIA_2_DESCRIZIONE
  , CS.DESCRIZIONE AS CATEGORIA_3_DESCRIZIONE
FROM
    ANAGRAFICAARTICOLI AS AA
    LEFT OUTER JOIN ANAGRAFICAARTICOLICOMM AS AAC
        ON AAC.CODICEART = AA.CODICE
           AND AAC.ESERCIZIO = Year (GetDate ())
    LEFT OUTER JOIN ANAGRAFICAARTICOLICOMM AS AACParent
        ON AACParent.CODICEART = AA.CODICEPRIMARIO
           AND AACParent.ESERCIZIO = AAC.ESERCIZIO
    LEFT OUTER JOIN TABCATEGORIE AS C
        ON C.CODICE = AA.CATEGORIA
    LEFT OUTER JOIN TABGRUPPI AS G
        ON G.CODICE = AA.GRUPPO
    LEFT OUTER JOIN TABCATEGORIESTAT AS CS
        ON CS.CODICE = AA.CODCATEGORIASTAT
    LEFT OUTER JOIN TRATTAMENTOIVA AS IVA
        ON IVA.CODICE = AAC.CODIVA
    CROSS JOIN TABLINGUE;
GO
GRANT SELECT
    ON OBJECT::[dbo].[View_Oxatis_Products] TO [Metodo98]
    AS [dbo];

