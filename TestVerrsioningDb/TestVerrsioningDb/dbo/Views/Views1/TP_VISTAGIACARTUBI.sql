

CREATE VIEW TP_VISTAGIACARTUBI
AS

SELECT  
                     ANAGRAFICAARTICOLI.CODICE,
                     ANAGRAFICAARTICOLI.DESCRIZIONE,
                     ANAGRAFICAARTICOLI.GRUPPO,
                     ANAGRAFICAARTICOLI.CATEGORIA,
                     ANAGRAFICAARTICOLI.CODCATEGORIASTAT,
                     ANAGRAFICAARTICOLI.VARESPLICITE,
                     ANAGRAFICAARTICOLI.CODICEPRIMARIO,
                     ANAGRAFICAARTICOLI.ARTTIPOLOGIA,
                     ANAGRAFICAARTICOLI.DESCRESTESA,
                     Ubi.CODUBICAZIONE, 
                     Ubi.QTAMIN,
                     Ubi.QTAMAX,
                     Ubi.CODDEPOSITO, 
                     TABUBICAZIONIDEPOSITI.DESCRIZIONE                      AS DESCRUBI,
                     TABUBICAZIONIDEPOSITI.TIPOUBICAZIONE,
                     ISNULL(SUM (TP_VISTAGIACLOTTI.GIAC), 0)                AS GIAC
FROM         ANAGRAFICAARTICOLI INNER JOIN
                   (SELECT DISTINCT CODDEPOSITO,CODUBICAZIONE,CODICEART,QTAMIN,QTAMAX FROM UBICAZIONIARTICOLI) AS Ubi ON ANAGRAFICAARTICOLI.CODICE = Ubi.CODICEART 
                   INNER JOIN TABUBICAZIONIDEPOSITI ON
                   Ubi.CODDEPOSITO=TABUBICAZIONIDEPOSITI.CODDEPOSITO AND
                   Ubi.CODUBICAZIONE=TABUBICAZIONIDEPOSITI.CODUBICAZIONE
                   LEFT OUTER JOIN
                   TP_VISTAGIACLOTTI ON Ubi.CODICEART = TP_VISTAGIACLOTTI.CODART AND 
                   Ubi.CODDEPOSITO = TP_VISTAGIACLOTTI.CODDEPOSITO AND 
                   Ubi.CODUBICAZIONE = TP_VISTAGIACLOTTI.CODUBICAZIONE

GROUP BY 
                    ANAGRAFICAARTICOLI.CODICE,
                    ANAGRAFICAARTICOLI.DESCRIZIONE,
                    ANAGRAFICAARTICOLI.GRUPPO,
                    ANAGRAFICAARTICOLI.CATEGORIA,
                    ANAGRAFICAARTICOLI.CODCATEGORIASTAT,
                    ANAGRAFICAARTICOLI.VARESPLICITE,
                    ANAGRAFICAARTICOLI.CODICEPRIMARIO,
                    ANAGRAFICAARTICOLI.ARTTIPOLOGIA,
                    ANAGRAFICAARTICOLI.DESCRESTESA,
                    Ubi.CODUBICAZIONE, 
                    Ubi.QTAMIN,
                    Ubi.QTAMAX,
                    Ubi.CODDEPOSITO, 
                    TABUBICAZIONIDEPOSITI.DESCRIZIONE,                      
                    TABUBICAZIONIDEPOSITI.TIPOUBICAZIONE



GO
GRANT DELETE
    ON OBJECT::[dbo].[TP_VISTAGIACARTUBI] TO [Metodo98]
    AS [dbo];


GO
GRANT INSERT
    ON OBJECT::[dbo].[TP_VISTAGIACARTUBI] TO [Metodo98]
    AS [dbo];


GO
GRANT REFERENCES
    ON OBJECT::[dbo].[TP_VISTAGIACARTUBI] TO [Metodo98]
    AS [dbo];


GO
GRANT SELECT
    ON OBJECT::[dbo].[TP_VISTAGIACARTUBI] TO [Metodo98]
    AS [dbo];


GO
GRANT UPDATE
    ON OBJECT::[dbo].[TP_VISTAGIACARTUBI] TO [Metodo98]
    AS [dbo];

