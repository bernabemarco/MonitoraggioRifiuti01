

CREATE VIEW [dbo].[VISTA_MB_Righe_Tipologie_in_Colonne]
                AS
                (SELECT CC.IDTESTA, CC.IDRIGA, MAX(CC.Qtatax) QTATAX, MAX(CC.QTAUM) QTAUM ,SUM(IA016C) AS IA016C,SUM(IC015C) AS IC015C,SUM(PC011C) AS PC011C,SUM(PC012C) AS PC012C,SUM(PC020C) AS PC020C,SUM(PC022C) AS PC022C,SUM(PC023C) AS PC023C,SUM(PI017C) AS PI017C,SUM(PI018C) AS PI018C,SUM(RC007C) AS RC007C,SUM(RC008C) AS RC008C,SUM(RI019C) AS RI019C,SUM(RP013C) AS RP013C,SUM(RP014C) AS RP014C,SUM(TA004C) AS TA004C,SUM(TA005C) AS TA005C,SUM(TA006C) AS TA006C,SUM(TC001C) AS TC001C,SUM(TC002C) AS TC002C,SUM(TC003C) AS TC003C,SUM(TC021C) AS TC021C,SUM(SB001C) AS SB001C,SUM(SB002C) AS SB002C,SUM(SB003C) AS SB003C,SUM(SB004C) AS SB004C,SUM(SB005C) AS SB005C,SUM(SB006C) AS SB006C,SUM(SB007C) AS SB007C,SUM(SB008C) AS SB008C,SUM(SL009C) AS SL009C,SUM(SL010C) AS SL010C,SUM(SL011C) AS SL011C,SUM(SL012C) AS SL012C,SUM(SL013C) AS SL013C,SUM(SL014C) AS SL014C,SUM(SL015C) AS SL015C,SUM(SL016C) AS SL016C,SUM(SL017C) AS SL017C,SUM(SL018C) AS SL018C,SUM(SL100F) AS SL100F,SUM(SL101F) AS SL101F,SUM(SL102F) AS SL102F,SUM(SL103F) AS SL103F,SUM(CC001C) AS CC001C,SUM(CC003C) AS CC003C,SUM(CC004C) AS CC004C,SUM(CC006C) AS CC006C,SUM(CC007C) AS CC007C,SUM(CC009C) AS CC009C,SUM(CC011C) AS CC011C,SUM(CC012C) AS CC012C,SUM(CC013C) AS CC013C,SUM(CC014C) AS CC014C,SUM(CC015C) AS CC015C,SUM(CC016C) AS CC016C,SUM(CC017C) AS CC017C,SUM(CC018C) AS CC018C,SUM(CC019C) AS CC019C,SUM(CC020C) AS CC020C,SUM(CC021C) AS CC021C,SUM(CC022C) AS CC022C,SUM(CC023C) AS CC023C,SUM(CI001C) AS CI001C,SUM(CI002C) AS CI002C,SUM(CI005C) AS CI005C,SUM(CI008C) AS CI008C,SUM(CI010C) AS CI010C,SUM(CI011C) AS CI011C,SUM(CI012C) AS CI012C,SUM(CI013C) AS CI013C,SUM(CI014C) AS CI014C,SUM(CI015C) AS CI015C,SUM(CI016C) AS CI016C,SUM(CI017C) AS CI017C,SUM(CI018C) AS CI018C,SUM(CI019C) AS CI019C,SUM(CI020C) AS CI020C 
                FROM 
                (SELECT  IDRIGADOC AS IDRIGA , IDTESTADOC AS IDTESTA, QTATAX, QTAUM  ,[IA016C],[IC015C],[PC011C],[PC012C],[PC020C],[PC022C],[PC023C],[PI017C],[PI018C],[RC007C],[RC008C],[RI019C],[RP013C],[RP014C],[TA004C],[TA005C],[TA006C],[TC001C],[TC002C],[TC003C],[TC021C],[SB001C],[SB002C],[SB003C],[SB004C],[SB005C],[SB006C],[SB007C],[SB008C],[SL009C],[SL010C],[SL011C],[SL012C],[SL013C],[SL014C],[SL015C],[SL016C],[SL017C],[SL018C],[SL100F],[SL101F],[SL102F],[SL103F],[CC001C],[CC003C],[CC004C],[CC006C],[CC007C],[CC009C],[CC011C],[CC012C],[CC013C],[CC014C],[CC015C],[CC016C],[CC017C],[CC018C],[CC019C],[CC020C],[CC021C],[CC022C],[CC023C],[CI001C],[CI002C],[CI005C],[CI008C],[CI010C],[CI011C],[CI012C],[CI013C],[CI014C],[CI015C],[CI016C],[CI017C],[CI018C],[CI019C],[CI020C] 
                FROM 
                    (
                    SELECT   IDTESTA  IDTestaDoc, IDRIGA IDRigaDoc, Cod,  CASE ValoreVenduto WHEN 0 THEN ValoreAcquistato ELSE ValoreVenduto END Valorevenduto ,  Qtatax, QtaUm
                    FROM     dbo.MB_Dettaglio_Tipologie
                    ) AS SourceTable
                PIVOT
                (
                SUM(valorevenduto)
                FOR [COD]
                IN ([IA016C],[IC015C],[PC011C],[PC012C],[PC020C],[PC022C],[PC023C],[PI017C],[PI018C],[RC007C],[RC008C],[RI019C],[RP013C],[RP014C],[TA004C],[TA005C],[TA006C],[TC001C],[TC002C],[TC003C],[TC021C],[SB001C],[SB002C],[SB003C],[SB004C],[SB005C],[SB006C],[SB007C],[SB008C],[SL009C],[SL010C],[SL011C],[SL012C],[SL013C],[SL014C],[SL015C],[SL016C],[SL017C],[SL018C],[SL100F],[SL101F],[SL102F],[SL103F],[CC001C],[CC003C],[CC004C],[CC006C],[CC007C],[CC009C],[CC011C],[CC012C],[CC013C],[CC014C],[CC015C],[CC016C],[CC017C],[CC018C],[CC019C],[CC020C],[CC021C],[CC022C],[CC023C],[CI001C],[CI002C],[CI005C],[CI008C],[CI010C],[CI011C],[CI012C],[CI013C],[CI014C],[CI015C],[CI016C],[CI017C],[CI018C],[CI019C],[CI020C])
                )
                AS p) CC
                GROUP BY CC.IDTESTA, CC.IDRIGA)

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTA_MB_Righe_Tipologie_in_Colonne] TO [Metodo98]
    AS [dbo];

