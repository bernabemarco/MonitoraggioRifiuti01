CREATE VIEW VISTACOMMCLICOSTILAVINT AS
SELECT 
    IDCOMMCLI,
    RIFCOMM,
    RIFCOMMRIEP,
    CLICOMMITT,
    TIPOCOM,
    ANNOCOM,
    NUMCOM,
    DATAEMISSIONE,
    STATOCOMMESSA,
    FLGTIPOCOMM,    
    NRRIGA,
    IDCOMMPROD AS RIFTESTA,
    IDORDPROD AS RIFRIGA,
    ORIGINEEVENTO,
    IDCOMMPROD AS RIFTESTA_DEST,
    IDORDPROD AS RIFRIGA_DEST,
    ORIGINEEVENTO AS ORIGINEEVENTO_DEST,    
    IDCICLO,
    NRFASECICLO,
    ANNOBOLLA,
    NUMEROBOLLA,
    CODART,
    REPARTO,
    CODCDLAVORO,
    CODMACCHINA,
    CODOPERAZIONE,
    COSTOSETUP,
    COSTORIS,
    COSTOUOMO,
    COSTOINDVAR,
    COSTOTOTALE,
    COSTOSETUPEURO,
    COSTORISEURO,
    COSTOUOMOEURO,
    COSTOINDVAREURO,
    COSTOTOTALEEURO,
    NATURARILEVAZIONE,
    TIPOREC,
    (CASE WHEN NATURARILEVAZIONE=1 THEN COSTOTOTALE ELSE 0 END) AS COSTOVALCONSUMATO,
    (CASE WHEN NATURARILEVAZIONE=4 THEN COSTOTOTALE ELSE 0 END) AS COSTOVALPREVISTO,
    (CASE WHEN NATURARILEVAZIONE=1 THEN COSTOTOTALEEURO ELSE 0 END) AS COSTOVALCONSUMATOEURO,
    (CASE WHEN NATURARILEVAZIONE=4 THEN COSTOTOTALEEURO ELSE 0 END) AS COSTOVALPREVISTOEURO,    
    VOCEBASE,
    IDVOCE,
    0 AS NUMEROMOV
FROM 
    CCBILANCIOCONSLAVINT CC INNER JOIN ANAGRAFICACOMMESSE AC ON CC.IDCOMMCLI=AC.PROGRESSIVO

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTACOMMCLICOSTILAVINT] TO [Metodo98]
    AS [dbo];

