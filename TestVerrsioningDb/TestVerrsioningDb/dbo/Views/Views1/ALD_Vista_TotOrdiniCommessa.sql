
CREATE view  [dbo].[ALD_Vista_TotOrdiniCommessa]
as
SELECT     RIGHEDOCUMENTI.RIFCOMMCLI, TESTEDOCUMENTI.PROGRESSIVO AS IdTesta, testedocumenti.docchiuso, TESTEDOCUMENTI.ESERCIZIO, TESTEDOCUMENTI.TIPODOC, 
                      TESTEDOCUMENTI.NUMERODOC, MAX(RIGHEDOCUMENTI.DATACONSEGNA) AS MaxDtConsegna, SUM(RIGHEDOCUMENTI.TOTNETTORIGAEURO) 
                      AS T_TOTNETTORIGAEURO, SUM(RIGHEDOCUMENTI.TOTNETTORIGAEURORES) AS T_TOTNETTORIGAEURORes
FROM         RIGHEDOCUMENTI INNER JOIN
                      TESTEDOCUMENTI ON RIGHEDOCUMENTI.IDTESTA = TESTEDOCUMENTI.PROGRESSIVO INNER JOIN
                      PARAMETRIDOC ON TESTEDOCUMENTI.TIPODOC = PARAMETRIDOC.CODICE
WHERE     (PARAMETRIDOC.TIPO = 'O') AND (PARAMETRIDOC.CLIFOR = 'C') and len(RIGHEDOCUMENTI.RIFCOMMCLI)>0
GROUP BY RIGHEDOCUMENTI.RIFCOMMCLI, TESTEDOCUMENTI.PROGRESSIVO, testedocumenti.docchiuso, TESTEDOCUMENTI.ESERCIZIO, TESTEDOCUMENTI.TIPODOC, 
                      TESTEDOCUMENTI.NUMERODOC



GO
GRANT SELECT
    ON OBJECT::[dbo].[ALD_Vista_TotOrdiniCommessa] TO [Metodo98]
    AS [dbo];

