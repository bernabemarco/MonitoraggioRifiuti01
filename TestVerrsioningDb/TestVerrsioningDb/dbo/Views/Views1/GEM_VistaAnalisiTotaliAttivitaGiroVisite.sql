


/****** Oggetto:  View [dbo].[GEM_VistaAnalisiTotaliAttivitaGiroVisite]    Data script: 03/21/2013 14:32:38 ******/
CREATE VIEW [dbo].[GEM_VistaAnalisiTotaliAttivitaGiroVisite]
AS
SELECT     Rapp.DATA_PREV, (case when year(SCDM.DATA_PREV)<=year(Rapp.DATA_PREV) then 1 else 0 end) as isMezzoRev, 
(case when year(SCDM.DATA_PCOLL)<=year(Rapp.DATA_PREV) then 1 else 0 end) as isMezzoCol, 
Rapp.IDRAPPORTO, Rapp.SEZIONECONTRATTO, rapp.IDCONTRATTO, rapp.TIPO_RAPPORTO, Rapp.TIPOLOGIARAPPORTO, 
rapp.stato as statoRapp,
rapp.TECNICO_EFF, rapp.TECNICO_PREV,
Rapp.RIFCOMMCLI, Rapp.DA_FATT, SC.CodiceMezzo,
                          (SELECT     COUNT(IdRigaMezzo) AS NrMezziAttivi
                            FROM          GEM_SEZIONECONTRATTORAPPORTIMEZZI AS DMR
                            WHERE      (IDRAPPORTO = Rapp.IDRAPPORTO) AND (ISNULL(ELIMINATO, '0') IN ('0', ''))) AS NrMezziAttivi, AnaArt.VARESPLICITE, SCDM.idTipologMezzo, 
                      SCDM.OreLavorate, SCDM.variante, 
					  SCDM.IdRigaMezzo, 
                      SCDM.IDRAPPORTOAGGREGATO, SCDM.CodMezzo, SCDM.DataInserimento, SCDM.DataEliminazione, SCDM.ELIMINATO, SCDM.POSIZIONE, SCDM.SUBPOSIZIONE, 
                      SCDM.UBICAZIONE, SCDM.POSCLIENTE, SCDM.NOTE, SCDM.ORDINE, SCDM.CarTesto1, SCDM.CarTesto2, SCDM.CarTesto3, SCDM.CarTesto4, SCDM.CarTesto5, 
                      SCDM.CarTesto6, SCDM.CarTesto7, SCDM.CarTesto8, SCDM.CarTesto9, SCDM.CodiceBarre, SCDM.OMOLOGATO, SCDM.ANNO, SCDM.FLAG_INST, SCDM.STATO, 
                      SCDM.POSQLIK, SCDM.QUANTITA, SCDM.TEMPO_MAN, SCDM.IMPORTOAT1, SCDM.IMPORTOAT2, SCDM.IMPORTOAT3, SCDM.IMPORTOAT4, SCDM.IMPORTOAT5, 
                      SCDM.SCONTOAT1, SCDM.SCONTOAT2, SCDM.SCONTOAT3, SCDM.SCONTOAT4, SCDM.SCONTOAT5, SCDM.PROV1AT1, SCDM.PROV1AT2, SCDM.PROV1AT3, 
                      SCDM.PROV1AT4, SCDM.PROV1AT5, SCDM.PROV2AT1, SCDM.PROV2AT2, SCDM.PROV2AT3, SCDM.PROV2AT4, SCDM.PROV2AT5, SCDM.PROV3AT1, 
                      SCDM.PROV3AT2, SCDM.PROV3AT3, SCDM.PROV3AT4, SCDM.PROV3AT5, SCDM.StatoFuoriSede, SCDM.StatoAttivita, SCDM.FLAGAT1, SCDM.FLAGAT2, 
                      SCDM.FLAGAT3, SCDM.FLAGAT4, SCDM.FLAGAT5, SCDM.FLAGRICARICA, SCDM.DATA_REV, SCDM.DATA_PREV AS Dt_PRevisione, SCDM.DATA_COLL, SCDM.DATA_PCOLL, 
                      SCDM.PRESSIONE_DIN, SCDM.PRESSIONE_STA, SCDM.CAMPO01, SCDM.CAMPO02, SCDM.CAMPO03, SCDM.CAMPO04, SCDM.CAMPO05, SCDM.CAMPO06, 
                      SCDM.CAMPO07, SCDM.CAMPO08, SCDM.CAMPO09, SCDM.CAMPO10, SCDM.CAMPO11, SCDM.CAMPO12, SCDM.CAMPO13, SCDM.CAMPO14, SCDM.CAMPO15, 
                      SCDM.CAMPO16, SCDM.CAMPO17, SCDM.CAMPO18, SCDM.CAMPO19, SCDM.CAMPO20, SCDM.CAMPO21, SCDM.CAMPO22, SCDM.CAMPO23, SCDM.CAMPO24, 
                      SCDM.CAMPO25, SCDM.CAMPO26, SCDM.CAMPO27, SCDM.CAMPO28, SCDM.CAMPO29, SCDM.CAMPO30, SCDM.CAMPO31, SCDM.CAMPO32, SCDM.CAMPO33, 
                      SCDM.CAMPO34, SCDM.CAMPO35, SCDM.CAMPO36, SCDM.CAMPO37, SCDM.CAMPO38, SCDM.CAMPO39, SCDM.CAMPO40, SCDM.CAMPO41, SCDM.CAMPO42, 
                      SCDM.CAMPO43, SCDM.CAMPO44, SCDM.CAMPO45, SCDM.CAMPO46, SCDM.CAMPO47, SCDM.CAMPO48, SCDM.CAMPO49, SCDM.CAMPO50, SCDM.SEGNALATO, 
                      SCDM.NUOVARIGA, SCDM.UTENTEMODIFICA, SCDM.DATAMODIFICA, SCDM.UltimaAttivitaEseg, SCDM.CodiceMezzoChekList, SCDM.VersioneChekList, 
                      SCDM.TitoloChekList, SCDM.AnnotazioniTecnica
FROM         ANAGRAFICAARTICOLI AS AnaArt INNER JOIN
                      Gem_Vista_DettMezziRapp_Varianti AS SCDM INNER JOIN
                      GEM_SEZIONECONTRATTORAPPORTI AS Rapp ON SCDM.IDRAPPORTO = Rapp.IDRAPPORTO ON AnaArt.CODICE = SCDM.CodMezzo LEFT OUTER JOIN
                      GEM_SEZIONICONTRATTO AS SC ON Rapp.SEZIONECONTRATTO = SC.SEZIONECONTRATTO AND Rapp.IDCONTRATTO = SC.IDCONTRATTO LEFT OUTER JOIN
                      GEM_TESTACONTRATTO AS TC ON SC.IDCONTRATTO = TC.IDCONTRATTO
WHERE     (ISNULL(SCDM.ELIMINATO, '0') IN ('0', '')) AND (Rapp.STATO IN ('X', 'T', 'R'))



GO
GRANT SELECT
    ON OBJECT::[dbo].[GEM_VistaAnalisiTotaliAttivitaGiroVisite] TO [Metodo98]
    AS [dbo];

