

CREATE VIEW [dbo].[TP_VISTAORDINEFORNITORE_BIS] 
AS

SELECT  
    TLRRD.CODART,
    ANAGA.DESCRIZIONE AS DESCARTICOLO,
    ANAGA.DESCRIZIONE AS DESCRIZIONEART,
    TLRRD.CODFOR,
    TLRRD.TP_CODDEP,
    ANAGA.GRUPPO,
    ANAGA.CATEGORIA,
    ANAGA.CODCATEGORIASTAT,             
    TXMAG.CODFAMIGLIAPOS,
    TXMAG.CODREPARTOPOS,
    ANAGA.VARESPLICITE,
    TXMAG.CODMARCHIO,
    COUNT_BIG(*) AS TOTALE
FROM    
    dbo.TABLOTTIRIORDINO TLRRD
INNER JOIN
    dbo.TP_EXTRAMAG TXMAG
ON
    TXMAG.CODART = TLRRD.CODART AND 
    TXMAG.CONSIDACQ = 1
INNER JOIN
    dbo.ANAGRAFICAARTICOLI ANAGA
ON
    ANAGA.CODICE = TXMAG.CODART AND 
    ANAGA.ARTTIPOLOGIA = 0
/*INNER JOIN
    dbo.EXTRAMAG EXTMAG
ON
    EXTMAG.CODART = TLRRD.CODART*/ --SOLO PER TRILOGS
WHERE
    ((TLRRD.CODART <> '' AND TLRRD.CODART IS NOT NULL)) AND 
    ((TLRRD.CODFOR <> '' AND TLRRD.CODFOR IS NOT NULL)) AND
    ((TLRRD.TP_FORNFATTURAZIONE <> '' AND TLRRD.TP_FORNFATTURAZIONE IS NOT NULL)) AND
    ((TLRRD.TP_CODDEP <> '' AND TLRRD.TP_CODDEP IS NOT NULL))
GROUP BY 
    TLRRD.CODART,
    ANAGA.DESCRIZIONE,
    TLRRD.CODFOR,
    TLRRD.TP_CODDEP,
    ANAGA.GRUPPO,
    ANAGA.CATEGORIA,
    ANAGA.CODCATEGORIASTAT,             
    TXMAG.CODFAMIGLIAPOS,
    TXMAG.CODREPARTOPOS,
    ANAGA.VARESPLICITE,
    TXMAG.CODMARCHIO

GO
GRANT SELECT
    ON OBJECT::[dbo].[TP_VISTAORDINEFORNITORE_BIS] TO [Metodo98]
    AS [dbo];

