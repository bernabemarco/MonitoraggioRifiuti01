CREATE VIEW BRIOVISTA_MOVIMENTICDC AS 
SELECT

	MCDC.ANNO ANNOCOMP, MCDC.MESE AS MESECOMP, 
	YEAR(MCDC.DATAREG) AS ANNOREG, STR(MONTH(MCDC.DATAREG), 2, 0) + ' - ' + DATENAME(MM, MCDC.DATAREG) AS MESEREG,MCDC.DATAREG,
	AC.CLICOMMITT AS COMMITTENTE,AC.CLIFATT AS CLIENTEFATTURAZIONE, MCDC.CODCOMMESSA, 
	(CASE AC.STATOCOMMESSA WHEN 0 THEN 'IMMESSA' WHEN 1 THEN 'ATTIVA' WHEN 2 THEN 'SOSPESA' ELSE 'CHIUSA' END) AS STATOCOMMESSA,
	TC.CAUSALE, CC.DESCRIZIONE AS DESCRIZIONECAUSALE,
	CASE WHEN TC.PROVVISORIO=0 THEN 'Definitivo' ELSE 'Provvisorio' END AS STATOMOVIMENTO,
	MCDC.CODCONTOCC AS CODICECDC, CDC.DESCRIZIONE AS DESCRIZIONECDC,
	CFG.CODMASTRO, MST.DESCRIZIONE AS DESCRIZIONEMASTRO,
	MCDC.CODGENERICO AS CODICEGENERICO, CFG.DSCCONTO1 AS DESCRIZIONEGENERICO,
	CASE WHEN MCDC.SEGNO=0 THEN IMPORTORIPEURO ELSE 0 END AS IMPORTODARE,
	CASE WHEN MCDC.SEGNO=1 THEN IMPORTORIPEURO ELSE 0 END AS IMPORTOAVERE

FROM MOVIMENTICDC MCDC
	INNER JOIN TABCFG CFG ON MCDC.CODGENERICO=CFG.CODCONTO
	INNER JOIN TABMASTRI MST ON CFG.CODMASTRO=MST.CODICE
	LEFT OUTER JOIN ANAGRAFICACOMMESSE AC ON MCDC.CODCOMMESSA=AC.RIFCOMM
	LEFT OUTER JOIN TABCENTRICOSTO CDC ON MCDC.CODCONTOCC=CDC.CODICE
	LEFT OUTER JOIN TESTECONTABILITA TC ON MCDC.IDRIFERIMENTO=TC.PROGRESSIVO
	LEFT OUTER JOIN CAUSALICONTABILI CC ON TC.CAUSALE=CC.CODICECAUSALE

GO
GRANT SELECT
    ON OBJECT::[dbo].[BRIOVISTA_MOVIMENTICDC] TO [Metodo98]
    AS [dbo];

