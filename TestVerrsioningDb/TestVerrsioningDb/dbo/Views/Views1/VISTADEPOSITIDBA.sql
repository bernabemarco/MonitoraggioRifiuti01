CREATE VIEW VISTADEPOSITIDBA AS
SELECT 
    ANAGRAFICADEPOSITI.CODICE, 
    ANAGRAFICADEPOSITI.TIPODEPOSITO, 
    ANAGRAFICADEPOSITI.DISPONIBILE, 
    ANAGRAFICADEPOSITI.DESCRIZIONE, 
    ANAGRAFICADEPOSITI.PRINCIPALE, 
    ANAGRAFICADEPOSITI.DATAINIVALIDITA, 
    ANAGRAFICADEPOSITI.DATAFINEVALIDITA, 
    ANAGRAFICADEPOSITI.UTENTEMODIFICA, 
    ANAGRAFICADEPOSITI.DATAMODIFICA
FROM 
    ANAGRAFICADEPOSITI, TABESERCIZI
WHERE 
    ANAGRAFICADEPOSITI.DATAFINEVALIDITA >= TABESERCIZI.DATAINIMAG
     AND ANAGRAFICADEPOSITI.DATAINIVALIDITA <= TABESERCIZI.DATAFINEMAG
     AND (TABESERCIZI.CODICE = (SELECT ESERCIZIOATTIVO FROM TABUTENTI WHERE USERDB = CAST(USER_NAME() AS VARCHAR(25))))
GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTADEPOSITIDBA] TO [Metodo98]
    AS [dbo];

