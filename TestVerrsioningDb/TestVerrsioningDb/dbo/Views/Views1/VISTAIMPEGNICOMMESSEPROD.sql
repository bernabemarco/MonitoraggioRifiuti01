CREATE VIEW VISTAIMPEGNICOMMESSEPROD AS
SELECT 
	TESTEORDINIPROD.TIPOCOM+'/'+cast(TESTEORDINIPROD.ESERCIZIO as varchar)+'/'+right('0000000000'+cast(TESTEORDINIPROD.NUMEROCOM as varchar),10)+'/'+right('00000'+cast(RIGHEORDPROD.IDRIGA as varchar),5) as RIFORDINE,
	TESTEORDINIPROD.TIPOCOM+'/'+cast(TESTEORDINIPROD.ESERCIZIO as varchar)+'/'+right('0000000000'+cast(TESTEORDINIPROD.NUMEROCOM as varchar),10)+'/'+right('00000'+cast(RIGHEORDPROD.IDRIGA as varchar),5)+'/'+right('00000'+cast(IMPEGNIORDPROD.IDIMPEGNO as varchar),5) as RIFIMPEGNO,
	TESTEORDINIPROD.ESERCIZIO,
	TESTEORDINIPROD.TIPOCOM,
	TESTEORDINIPROD.NUMEROCOM,
	TESTEORDINIPROD.DATAEMISSIONE,
	TESTEORDINIPROD.PIANOPRODRIF,
	TESTEORDINIPROD.CODCLIENTE,
	TESTEORDINIPROD.ANNOTAZIONI,
	TESTEORDINIPROD.STATOCHIUSO,
	TESTEORDINIPROD.STATOBLOCCATO,
	RIGHEORDPROD.IDTESTA,RIGHEORDPROD.IDRIGA,
	RIGHEORDPROD.CODICEORD,
	(select TIPOORDINE from PARAMETRIORDPROD where
	  PARAMETRIORDPROD.CODICE = RIGHEORDPROD.CODICEORD) as TIPOORD,
	RIGHEORDPROD.CODART as CODARTORD,
	RIGHEORDPROD.DESCRIZIONEART,
	RIGHEORDPROD.VERSIONEDBA,
	RIGHEORDPROD.VERSIONECICLO,
	RIGHEORDPROD.UMGEST,RIGHEORDPROD.QTAGESTIONE,
	RIGHEORDPROD.QTAGESTIONEVERS,
	RIGHEORDPROD.QTAGESTIONERES,
	RIGHEORDPROD.QTAPREZZO,
	RIGHEORDPROD.UMPREZZO,
	RIGHEORDPROD.QTA1MAG,
	RIGHEORDPROD.UM1MAG as UM1ORD,
	RIGHEORDPROD.QTA2MAG,
	RIGHEORDPROD.UM2MAG as UM2ORD,
	RIGHEORDPROD.QTA1MAGRES,
	RIGHEORDPROD.QTA2MAGRES,
	RIGHEORDPROD.QTASCARTO,
	RIGHEORDPROD.UMSCARTO,
	RIGHEORDPROD.IDCOSTOSTD,
	RIGHEORDPROD.CODCLIDEST,
	RIGHEORDPROD.PARTITAASSEGNATA,
	RIGHEORDPROD.PARTITAVINCOLATA,
	RIGHEORDPROD.CODFORDEST,
	RIGHEORDPROD.DATAEMISSIONE as DATAEMISSIONEORD,
	RIGHEORDPROD.TIPOSCHEDULAZIONE,
	RIGHEORDPROD.STATOORDINE,
	RIGHEORDPROD.FASERILASCIO,
	RIGHEORDPROD.DATARILASCIO,
	RIGHEORDPROD.DATAINIZIORICH,RIGHEORDPROD.DATAFINERICH,
	RIGHEORDPROD.CAUSALEMAG,RIGHEORDPROD.DEPOSITO,RIGHEORDPROD.UBICAZIONE,
	RIGHEORDPROD.CONTOCDC,RIGHEORDPROD.CAUSALEMAGCOLL,RIGHEORDPROD.DEPOSITOCOLL,
	RIGHEORDPROD.UBICAZIONECOLL,RIGHEORDPROD.CONTOCDCCOLL,
	RIGHEORDPROD.VALOREPRIORITA,
	RIGHEORDPROD.RAPPORTOCRITICO,
	RIGHEORDPROD.SLACKTIME,RIGHEORDPROD.NOTE,
	IMPEGNIORDPROD.IDIMPEGNO,
	IMPEGNIORDPROD.IDRIGA as IDRIGAIMP,
	IMPEGNIORDPROD.CODART as CODARTIMP,
	IMPEGNIORDPROD.DESCRIZIONEART as DESCRIZIONEARTIMP,
	IMPEGNIORDPROD.UMGEST as UMGESTIMP,
	IMPEGNIORDPROD.QTAUNITARIA,
	IMPEGNIORDPROD.QTAGESTIONE as QTAGESTIONEIMP,
	IMPEGNIORDPROD.QTAGESTIONEVERS as QTAGESTIONEVERSIMP,
	IMPEGNIORDPROD.QTAGESTIONERES as QTAGESTIONERESIMP,
	IMPEGNIORDPROD.QTAPREZZO as QTAPREZZOIMP,
	IMPEGNIORDPROD.UMPREZZO as UMPREZZOIMP,
	IMPEGNIORDPROD.QTA1MAG as QTA1MAGIMP,
	IMPEGNIORDPROD.QTA2MAG as QTA2MAGIMP,
	IMPEGNIORDPROD.QTA1MAGRES as QTA1MAGRESIMP,
	IMPEGNIORDPROD.QTA2MAGRES as QTA2MAGRESIMP,
	IMPEGNIORDPROD.UM1MAG as UM1IMP,
	IMPEGNIORDPROD.UM2MAG as UM2IMP,
	IMPEGNIORDPROD.CODFORIMP,
	IMPEGNIORDPROD.PARTITAASSEGNATA as PARTITAASSEGNATAIMP,
	IMPEGNIORDPROD.PARTITAVINCOLATA as PARTITAVINCOLATAIMP,
	IMPEGNIORDPROD.CAUSALEMAG as CAUSALEMAGIMP,IMPEGNIORDPROD.DEPOSITO as DEPOSITOIMP,
	IMPEGNIORDPROD.UBICAZIONE as UBICAZIONEIMP,IMPEGNIORDPROD.CONTOCDC as CONTOCDCIMP,
	IMPEGNIORDPROD.CAUSALEMAGCOLL as CAUSALEMAGCOLLIMP,IMPEGNIORDPROD.DEPOSITOCOLL as DEPOSITOCOLLIMP,
	IMPEGNIORDPROD.UBICAZIONECOLL as UBICAZIONECOLLIMP,IMPEGNIORDPROD.CONTOCDCCOLL as CONTOCDCCOLLIMP,
	IMPEGNIORDPROD.CODCLIIMP,
	IMPEGNIORDPROD.DATAEMISSIONE as DATAEMISSIONEIMP,
	IMPEGNIORDPROD.DATAIMPEGNORICH,
	IMPEGNIORDPROD.DATAIMPEGNOSCH,
	IMPEGNIORDPROD.STATOIMPEGNO,
	IMPEGNIORDPROD.TIPOIMPEGNO,
	IMPEGNIORDPROD.NOTE as NOTEIMP,
	IMPEGNIORDPROD.DATACALCCSTEFF,
	IMPEGNIORDPROD.DATACALCCSTPREV,
	IMPEGNIORDPROD.COSTOPREV,
	IMPEGNIORDPROD.COSTOUNITIMPPREV,IMPEGNIORDPROD.COSTOTOTIMPPREV,
	IMPEGNIORDPROD.COSTOPREVEURO,
	IMPEGNIORDPROD.COSTOUNITIMPPREVEURO,IMPEGNIORDPROD.COSTOTOTIMPPREVEURO,
	IMPEGNIORDPROD.COSTOEFF,
	IMPEGNIORDPROD.COSTOUNITIMPEFF,IMPEGNIORDPROD.COSTOTOTIMPEFF,
	IMPEGNIORDPROD.COSTOEFFEURO,
	IMPEGNIORDPROD.COSTOUNITIMPEFFEURO,IMPEGNIORDPROD.COSTOTOTIMPEFFEURO,
	VISTAANAGRAFICAARTICOLI.GRUPPO,
	VISTAANAGRAFICAARTICOLI.CATEGORIA,
	VISTAANAGRAFICAARTICOLI.VARESPLICITE,
	VISTAANAGRAFICAARTICOLI.TIPOGESTIONE,
	VISTAANAGRAFICAARTICOLI.FLOORSTOCK,
	DATEDIFF(DAY,IMPEGNIORDPROD.DATAIMPEGNOSCH,IMPEGNIORDPROD.DATAIMPEGNORICH) as RITARDO,
	IMPEGNIORDPROD.QTAGESTIONETRASF as QTAGESTIONETRASFIMP,
	IMPEGNIORDPROD.RIFCOMMCLI,
	(case when IMPEGNIORDPROD.QTAGESTIONE <> 0 then IMPEGNIORDPROD.QTAGESTIONEVERS/IMPEGNIORDPROD.QTAGESTIONE*100 else 0 end) as AVANZQTAIMP,
	(case when IMPEGNIORDPROD.COSTOTOTIMPPREV <> 0 then IMPEGNIORDPROD.COSTOTOTIMPEFF/IMPEGNIORDPROD.COSTOTOTIMPPREV*100 else 0 end) as AVANZCOSTIIMP,
	IMPEGNIORDPROD.DATAMODIFICA as DATAULTIMAATTIMP,
	RIGHEORDPROD.STATOLANCIO,
	RIGHEORDPROD.STATOSTAMPA,
	RIGHEORDPROD.DATALANCIO
FROM
	(TESTEORDINIPROD LEFT OUTER JOIN 
	(RIGHEORDPROD LEFT OUTER JOIN 
	(IMPEGNIORDPROD LEFT OUTER JOIN VISTAANAGRAFICAARTICOLI ON IMPEGNIORDPROD.CODART = VISTAANAGRAFICAARTICOLI.CODICE)
	ON IMPEGNIORDPROD.IDTESTA = RIGHEORDPROD.IDTESTA AND IMPEGNIORDPROD.IDRIGA = RIGHEORDPROD.IDRIGA)
	ON RIGHEORDPROD.IDTESTA = TESTEORDINIPROD.PROGRESSIVO)

GO
GRANT SELECT
    ON OBJECT::[dbo].[VISTAIMPEGNICOMMESSEPROD] TO [Metodo98]
    AS [dbo];

