CREATE TABLE [dbo].[PARFOGLICOMMCLI] (
    [CODICE]               VARCHAR (3)   NOT NULL,
    [DESCRIZIONE]          VARCHAR (50)  NULL,
    [CONTATORE]            DECIMAL (5)   NULL,
    [MANTIENIREV]          SMALLINT      NULL,
    [TIPOVALORIZZAZIONE]   SMALLINT      NULL,
    [LISTINO]              DECIMAL (5)   NULL,
    [IDCOSTOSTD]           VARCHAR (10)  NULL,
    [TIPOUMGEST]           DECIMAL (5)   NULL,
    [TIPOUMCOSTO]          DECIMAL (5)   NULL,
    [TIPORIGA]             VARCHAR (3)   NULL,
    [NOTE]                 VARCHAR (100) NULL,
    [UTENTEMODIFICA]       VARCHAR (25)  NOT NULL,
    [DATAMODIFICA]         DATETIME      NOT NULL,
    [NRLIVELLISTRUTTPREV]  SMALLINT      NULL,
    [FORMULAPREZZO]        VARCHAR (255) NULL,
    [TIPODOCIMPEGNI]       VARCHAR (3)   NULL,
    [TIPODOCORDACQUISTO]   VARCHAR (3)   NULL,
    [TIPOCOMMESSAPROD]     VARCHAR (3)   NULL,
    [TIPOORDPRODINTERNA]   VARCHAR (3)   NULL,
    [TIPOORDPRODCLP]       VARCHAR (3)   NULL,
    [TIPODOCPRODINTERNA]   VARCHAR (3)   NULL,
    [TIPODOCPRODCLP]       VARCHAR (3)   NULL,
    [FLGEMISSIMPORD]       SMALLINT      CONSTRAINT [DF_PARFOGLICOMMCLI_FLGEMISSIMPORD] DEFAULT (0) NULL,
    [FLGEMISSCOMMDOC]      SMALLINT      CONSTRAINT [DF_PARFOGLICOMMCLI_FLGEMISSCOMMDOC] DEFAULT (0) NULL,
    [FILESCRIPT_DATACOSTI] VARCHAR (50)  NULL,
    [FLGUSAPZP]            SMALLINT      CONSTRAINT [DF_PARFOGLICOMMCLI_FLGUSAPZP] DEFAULT (0) NULL,
    [FLGUSASCONTIFOR]      SMALLINT      CONSTRAINT [DF_PARFOGLICOMMCLI_FLGUSASCONTIFOR] DEFAULT (0) NULL,
    [AGENTECOSTO]          VARCHAR (100) NULL,
    [TIPOUMPREZZO]         DECIMAL (5)   NULL,
    [FILECONFEXPORTWORD]   VARCHAR (255) NULL,
    [TIPODOCSAL]           VARCHAR (3)   NULL,
    [CODIVASAL]            DECIMAL (5)   NULL,
    [CONTROP_ITA]          VARCHAR (7)   NULL,
    [CONTROP_EST]          VARCHAR (7)   NULL,
    CONSTRAINT [PK_PARFOGLICOMMCLI] PRIMARY KEY CLUSTERED ([CODICE] ASC) WITH (FILLFACTOR = 90)
);


GO
/*  DELETE TRIGGER "TD_PARAMETRIDOC" FOR TABLE "PARAMETRIDOC"  */
CREATE TRIGGER TD_PARFOGLICOMMCLI ON PARFOGLICOMMCLI FOR DELETE AS
BEGIN
    DECLARE
       @NUMROWS  INT,
       @ERRNO    INT,
       @ERRMSG   VARCHAR(255)

    SELECT  @NUMROWS = @@ROWCOUNT
    IF @NUMROWS = 0
       RETURN

	/* DELETE RESTRICT */  /* per OGNI Tabella CHILD in Relazione */
	/* CANNOT DELETE PARENT "PARFOGLICOMMCLI" IF CHILDREN STILL EXIST IN "TESTEFOGLICOMMCLI" */
	IF EXISTS (SELECT 1 FROM TESTEFOGLICOMMCLI T2, DELETED T1 WHERE T2.TIPO = T1.CODICE)
	BEGIN
		SELECT @ERRNO = 30006,
		@ERRMSG = 'Children still exist in "TESTEFOGLICOMMCLI". Cannot delete parent "PARFOGLICOMMCLI".'
		GOTO ERROR
	END
    
    RETURN

/*  ERRORS HANDLING  */
ERROR:
    RAISERROR (@ERRMSG, 1, 1)
    ROLLBACK  TRANSACTION
END

GO
GRANT DELETE
    ON OBJECT::[dbo].[PARFOGLICOMMCLI] TO [Metodo98]
    AS [dbo];


GO
GRANT INSERT
    ON OBJECT::[dbo].[PARFOGLICOMMCLI] TO [Metodo98]
    AS [dbo];


GO
GRANT REFERENCES
    ON OBJECT::[dbo].[PARFOGLICOMMCLI] TO [Metodo98]
    AS [dbo];


GO
GRANT SELECT
    ON OBJECT::[dbo].[PARFOGLICOMMCLI] TO [Metodo98]
    AS [dbo];


GO
GRANT UPDATE
    ON OBJECT::[dbo].[PARFOGLICOMMCLI] TO [Metodo98]
    AS [dbo];

